(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[0],{174:function(e,t,a){e.exports=a(282)},181:function(e,t,a){},182:function(e,t,a){},186:function(e,t,a){},191:function(e,t,a){},279:function(e,t,a){},280:function(e,t,a){},281:function(e,t,a){},282:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(9),r=a.n(s),o=a(151),l=a.n(o),c=(a(179),a(180),a(10)),h=a(11),u=a(15),d=a(14),m=a(165),p=a(17),g=(a(181),a(325)),f=a(324),v=a(317),b=a(322),y=a(321),E=a(156),w=a.n(E),k=a(323),x=(a(182),new window.webkitSpeechRecognition);x.lang="en-US";var O=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={recognizing:!1},n.toggleListen=n.toggleListen.bind(Object(p.a)(n)),n.listen=n.listen.bind(Object(p.a)(n)),n.elementRef=i.a.createRef(),n}return Object(h.a)(a,[{key:"renderChatHistory",value:function(){var e=this;return this.props.chats.map((function(t,a){return i.a.cloneElement(i.a.createElement(v.a,null,i.a.createElement(y.a,{primary:t.msg}),i.a.createElement(b.a,null,""!==t.msg?i.a.createElement(k.a,{edge:"end","aria-label":"Fail",onClick:function(){return e.props.goToQuestion(a)}},i.a.createElement(w.a,{className:"cross"})):null)),{key:a.toString()})}))}},{key:"isMounted",value:function(){return null!=this.elementRef.current}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&(e.preventDefault(),this.handleSubmit())}},{key:"componentDidMount",value:function(){document.addEventListener("keypress",this.handleKeyPress.bind(this))}},{key:"toggleListen",value:function(){console.log("togglelisten"),this.setState({recognizing:!this.state.recognizing},this.listen)}},{key:"listen",value:function(){this.state.recognizing?x.start():x.stop(),x.onresult=function(e){for(var t="",a=0;a<e.results.length;++a)e.results[a].isFinal&&(t+=e.results[a][0].transcript);document.getElementById("msg").innerHTML=t},x.onerror=function(e){console.log("Error in recognition: "+e.error)}}},{key:"handleSubmit",value:function(){var e=document.getElementById("msg").innerHTML;""!==e.replace(/\s/g,"")&&(this.props.setInteractState({msg:e,failed:!1}),this.props.stateManager.socket.emit("sendCommandToAgent",e),document.getElementById("msg").innerHTML="")}},{key:"render",value:function(){return i.a.createElement("div",{className:"Chat"},i.a.createElement("p",null,"Enter the command to the bot in the input box below"),i.a.createElement(f.a,null,this.renderChatHistory()),i.a.createElement("div",{contentEditable:"true",className:"Msg single-line",id:"msg",suppressContentEditableWarning:!0}," "),i.a.createElement(g.a,{className:"MsgButton",variant:"contained",color:"primary",onClick:this.handleSubmit.bind(this)}," ","Submit"," "),i.a.createElement("p",{id:"callbackMsg"},this.props.status),i.a.createElement("p",{id:"assistantReply"},"[Reply] ",this.props.agent_reply," "),i.a.createElement("br",null),i.a.createElement("br",null))}}]),a}(n.Component),M=a(332),j=(a(186),function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={view:0,parsing_error:!1,action_dict:{},feedback:""},n}return Object(h.a)(a,[{key:"finishQuestions",value:function(){var e={action_dict:this.state.action_dict,parsing_error:this.state.parsing_error,msg:this.props.chats[this.props.failidx].msg,feedback:this.state.feedback};this.props.stateManager.socket.emit("saveErrorDetailsToDb",e),this.props.goToMessage()}},{key:"saveFeedback",value:function(e){this.setState({feedback:e.target.value})}},{key:"renderParsingFail",value:function(){return i.a.createElement("div",null,i.a.createElement("h3",null," ","Thanks for letting me know that I didn't understand the command right."," "),i.a.createElement(g.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderParsingSuccess",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("h3",null," ","Okay, looks like I understood your command but couldn't follow it all the way through. Tell me more about what I did wrong :"," "),i.a.createElement(M.a,{style:{backgroundColor:"white"},id:"outlined-uncontrolled",label:"",margin:"normal",variant:"outlined",onChange:function(t){return e.saveFeedback(t)}}),i.a.createElement("div",null),i.a.createElement(g.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderEnd",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("h3",null," Thanks! Submit any other feedback here: "),i.a.createElement(M.a,{style:{backgroundColor:"white"},id:"outlined-uncontrolled",label:"",margin:"normal",variant:"outlined",onChange:function(t){return e.saveFeedback(t)}}),i.a.createElement("div",null),i.a.createElement(g.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderSemanticParserErrorQuestion",value:function(){var e=this,t=this.props.stateManager.memory.chatResponse,a=this.props.chats[this.props.failidx].msg;if(this.setState({action_dict:t[a]}),this.state.action_dict)if("dialogue_type"in this.state.action_dict){var n=this.state.action_dict.dialogue_type,s="";if("HUMAN_GIVE_COMMAND"===n){var r=this.state.action_dict.action_sequence[0],o=r.action_type.toLowerCase();s="to "+o+" ",["build","dig"].indexOf(o)>=0?("schematic"in r&&(s=s+"'"+r.schematic.text_span+"'"),"location"in r&&(s=s+" at location '"+r.location.text_span+"'"),s+=" ?"):["destroy","fill","spawn","copy","get","scout"].indexOf(o)>=0?("reference_object"in r&&(s=s+"'"+r.reference_object.text_span+"'"),"location"in r&&(s=s+" at location '"+r.location.text_span+"'"),s+=" ?"):["move"].indexOf(o)>=0?("location"in r&&(s=s+" at location '"+r.location.text_span+"'"),s+=" ?"):["stop","resume","undo"].indexOf(o)>=0&&("target_action_type"in r&&(s=s+" at location '"+r.target_action_type+"'"),s+=" ?")}else"GET_MEMORY"===n?s="to answer a question about something in the Minecraft world ?":"PUT_MEMORY"===n?s="to remember or learn something you taught it ?":"NOOP"===n&&(s="to do nothing ?")}else s="did you want me to do nothing ?";return i.a.createElement("div",{className:"question"},i.a.createElement("h5",null,"Did you want the assistant ",s),i.a.createElement(f.a,{className:"answers",component:"nav"},i.a.createElement(v.a,{button:!0,onClick:function(){return e.answerParsing(1)}},i.a.createElement(y.a,{primary:"Yes"})),i.a.createElement(v.a,{button:!0,onClick:function(){return e.answerParsing(2)}},i.a.createElement(y.a,{primary:"No"}))))}},{key:"answerParsing",value:function(e){1===e?this.setState({view:2}):2===e&&this.setState({parsing_error:!0,view:1})}},{key:"goToEnd",value:function(e){this.setState({view:3,new_action_dict:e})}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{className:"msg-header"},"Message you sent to the bot: ",i.a.createElement("br",null),this.props.chats[this.props.failidx].msg),0===this.state.view?this.renderSemanticParserErrorQuestion():null,1===this.state.view?this.renderParsingFail():null,2===this.state.view?this.renderParsingSuccess():null,3===this.state.view?this.renderEnd():null)}}]),a}(n.Component)),S=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={currentView:1,chatResponse:"",status:"",chats:[{msg:"",failed:!1}],failidx:-1,agent_reply:""},n.state=n.initialState,n.setAssistantReply=n.setAssistantReply.bind(Object(p.a)(n)),n.MessageRef=i.a.createRef(),n}return Object(h.a)(a,[{key:"setInteractState",value:function(e){var t=Object(m.a)(this.state.chats);t.shift(),t.push(e),this.setState({chats:t})}},{key:"setAssistantReply",value:function(e){this.setState({agent_reply:e.agent_reply})}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.props.stateManager.socket.on("showAssistantReply",this.setAssistantReply))}},{key:"getUrlParameterByName",value:function(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}},{key:"goToMessage",value:function(){var e=this.state.chats;-1!==this.state.failidx&&(e[this.state.failidx].failed=!0),this.setState({currentView:1,chats:e})}},{key:"goToQuestion",value:function(e){this.setState({currentView:2,chats:this.state.chats,failidx:e})}},{key:"render",value:function(){return i.a.createElement("div",{className:"App"},i.a.createElement("div",{className:"content"},1===this.state.currentView?i.a.createElement(O,{status:this.state.status,stateManager:this.props.stateManager,ref:this.MessageRef,chats:this.state.chats,agent_reply:this.state.agent_reply,goToQuestion:this.goToQuestion.bind(this),setInteractState:this.setInteractState.bind(this)}):null,2===this.state.currentView?i.a.createElement(j,{stateManager:this.props.stateManager,chats:this.state.chats,failidx:this.state.failidx,goToMessage:this.goToMessage.bind(this),failmsg:this.state.chats[this.state.failidx].msg}):null))}}]),a}(n.Component),_=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={status:"",world_state:{}},n.worldContainerRef=i.a.createRef(),n}return Object(h.a)(a,[{key:"getVoxelWorldInitialState",value:function(){this.props.stateManager.socket.emit("getVoxelWorldInitialState")}},{key:"componentDidUpdate",value:function(){this.worldContainerRef.current.contentWindow.postMessage(this.state,"*")}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),this.getVoxelWorldInitialState()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("div",{id:"world-container"},i.a.createElement("iframe",{id:"ifr",src:"VoxelWorld/world.html",title:"Voxel World",width:"900",height:"500",ref:this.worldContainerRef})),i.a.createElement("p",null,"Tip: press 'esc' to leave the voxel world, w/a/s/d to move, space to jump"))}}]),a}(i.a.Component),C=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={rgb:null,depth:null,objects:null,humans:null},n}return Object(h.a)(a,[{key:"render",value:function(){var e=this.props.stateManager;return i.a.createElement("div",null,i.a.createElement(S,{stateManager:e}),i.a.createElement(_,{stateManager:e}))}}]),a}(i.a.Component),R=(a(188),a(108)),I=(a(190),{width:600,margin:50}),T={minWidth:"60px",display:"inline-block"},D=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={url:n.props.stateManager.url,fps:0,connected:!1,image_quality:-1,image_resolution:-1},n.state=n.initialState,n.handleChange=n.handleChange.bind(Object(p.a)(n)),n.handleSubmit=n.handleSubmit.bind(Object(p.a)(n)),n.setImageSettings=n.setImageSettings.bind(Object(p.a)(n)),n.onImageQualityChange=n.onImageQualityChange.bind(Object(p.a)(n)),n.onImageResolutionChange=n.onImageResolutionChange.bind(Object(p.a)(n)),n}return Object(h.a)(a,[{key:"setImageSettings",value:function(e){this.setState(e)}},{key:"handleChange",value:function(e){this.setState({url:e.target.value})}},{key:"handleSubmit",value:function(e){this.props.stateManager.setUrl(this.state.url),e.preventDefault()}},{key:"handleClearSettings",value:function(e){this.props.stateManager.setDefaultUrl()}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.setState({connected:this.props.stateManager.connected}),this.props.stateManager.socket.on("image_settings",this.setImageSettings))}},{key:"onImageQualityChange",value:function(e){!0===this.state.connected&&this.props.stateManager.socket.emit("update_image_settings",{image_quality:e,image_resolution:this.state.image_resolution})}},{key:"onImageResolutionChange",value:function(e){!0===this.state.connected&&this.props.stateManager.socket.emit("update_image_settings",{image_quality:this.state.image_quality,image_resolution:e})}},{key:"render",value:function(){var e;e=!0===this.state.connected?i.a.createElement("status-indicator",{positive:!0,pulse:!0}):i.a.createElement("status-indicator",{negative:!0,pulse:!0});var t=!1;return-1===this.state.image_quality&&(t=!0),i.a.createElement("div",null,i.a.createElement("form",{onSubmit:this.handleSubmit},i.a.createElement("label",null,"Server / Robot URL:",i.a.createElement("input",{type:"text",value:this.state.url,onChange:this.handleChange})),i.a.createElement("input",{type:"submit",value:"Reconnect"})),i.a.createElement("form",{onSubmit:this.handleClearSettings},i.a.createElement("input",{type:"submit",value:"Clear Saved Settings"})),i.a.createElement("p",null,"FPS: ",this.state.fps),i.a.createElement("p",null," Connection Status: ",e," "),i.a.createElement("div",{style:I},i.a.createElement("label",{style:T},"Image Quality: \xa0"),i.a.createElement("span",null,this.state.image_quality),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(R.a,{value:this.state.image_quality,min:1,max:100,step:1,onChange:this.onImageQualityChange,disabled:t})),i.a.createElement("div",{style:I},i.a.createElement("label",{style:T},"Image Resolution: \xa0"),i.a.createElement("span",null,this.state.image_resolution),i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement(R.a,{value:this.state.image_resolution,min:16,max:512,step:16,onChange:this.onImageResolutionChange,disabled:t})))}}]),a}(i.a.Component),L=(a(191),function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"renderChatHistory",value:function(){return this.props.stateManager.memory.chats.map((function(e,t){return i.a.cloneElement(i.a.createElement(v.a,{alignItems:"flex-start"},i.a.createElement("div",{className:"chatItem"},""!==e.msg?i.a.createElement(y.a,{primary:e.msg}):null)),{key:t.toString()})}))}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return i.a.createElement("div",{className:"history"},i.a.createElement("p",null,"The history of the last 5 commands sent to the bot."),i.a.createElement(f.a,null,this.renderChatHistory()))}}]),a}(i.a.Component)),z=a(164),P=Object(z.a)({palette:{primary:{main:"#ffffff"},secondary:{main:"#5f5f5f"}}}),N=a(327),H=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleClick=function(){n.state.isTimerOn?(n.setState({isTimerOn:!1,isSessionEnd:!0}),n.props.stateManager.socket.emit("terminateAgent","")):(n.setState({isTimerOn:!0,startTime:Date.now()}),n.timer=setInterval((function(){n.setState({timeElapsed:Date.now()-n.state.startTime})}),10))},n.state={isTimerOn:!1,isSessionEnd:!1,startTime:0,timeElapsed:0},n}return Object(h.a)(a,[{key:"render",value:function(){var e=this.state.timeElapsed,t=("0"+Math.floor(e/1e3)%60).slice(-2),a=("0"+Math.floor(e/6e4)%60).slice(-2);return i.a.createElement(N.a,{theme:P},i.a.createElement("div",{className:"App"},i.a.createElement("div",{className:"content"},this.state.isSessionEnd?i.a.createElement("p",{style:{fontSize:40}},"Thanks for interacting with the bot. You may leave the page now."):i.a.createElement("div",null,i.a.createElement("div",{style:{fontSize:40}},a," : ",t),i.a.createElement("br",null),i.a.createElement(g.a,{className:"MsgButton",variant:"contained",color:this.state.isTimerOn?"secondary":"primary",onClick:this.handleClick.bind(this)},this.state.isTimerOn?"End":"Start"),i.a.createElement("br",null),i.a.createElement("p",null,"Please click on the button to start the session. "),i.a.createElement("p",null,"When you finished, click on the button to end the session and proceed to next steps.")))))}}]),a}(n.Component),V=a(158),A=a.n(V),W=a(28),U=a(328),B=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={height:400,width:600,isLoaded:!1,memory:null,xmin:-10,xmax:10,ymin:-10,ymax:10,bot_xyz:[0,0,0],tooltip:null},n.state=n.initialState,n.outer_div=i.a.createRef(),n.resizeHandler=n.resizeHandler.bind(Object(p.a)(n)),n}return Object(h.a)(a,[{key:"resizeHandler",value:function(){if(null!=this.outer_div&&null!=this.outer_div.current){var e=this.outer_div.current,t=e.clientHeight,a=e.clientWidth;(void 0!==t&&t!==this.state.height||void 0!==a&&a!==this.state.width)&&this.setState({height:t,width:a})}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),void 0!==this.props.glContainer&&this.props.glContainer.on("resize",this.resizeHandler)}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.bot_xyz,n=this.state,i=n.xmin,s=n.xmax,r=n.ymin,o=n.ymax,l=a[0],c=a[1],h=!1;l<i&&(i=l,h=!0),l>s&&(s=l,h=!0),c<r&&(r=c,h=!0),c>o&&(o=c,h=!0),h&&this.setState({xmin:i,ymin:r,xmax:s,ymax:o}),this.resizeHandler()}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return i.a.createElement("p",null,"Loading");var t=this.state,a=t.height,n=t.width,s=t.memory,r=t.bot_xyz,o=t.obstacle_map,l=t.tooltip,c=s.objects,h=this.state,u=h.xmin,d=h.xmax,m=h.ymin,p=h.ymax,g=r[1],f=-r[0],v=r[2];if(0===a&&0===n)return i.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}});g=parseInt((g-u)/(d-u)*n),f=parseInt((f-m)/(p-m)*a),f=a-f;var b=[],y=[],E=0;o&&o.forEach((function(e){var t=parseInt((e[0]-u)/(d-u)*n),s=parseInt((e[1]-m)/(p-m)*a);y.push(i.a.createElement(W.Circle,{key:E++,radius:2,x:t,y:s,fill:"#827f7f"}))})),c.forEach((function(t,s,r){var o,l=U.a[Math.abs((o=t.label,o.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)))%10],c=t.xyz,h=parseInt((c[2]-u)/(d-u)*n),g=parseInt((-c[0]-m)/(p-m)*a);g=a-g,b.push(i.a.createElement(W.Circle,{key:E++,radius:3,x:h,y:g,fill:l,onMouseEnter:function(a){e.setState({tooltip:JSON.stringify(t,null,4)}),a.currentTarget.setRadius(6)},onMouseLeave:function(t){e.setState({tooltip:null}),t.currentTarget.setRadius(3)}}))})),b.push(i.a.createElement(W.Circle,{key:E++,radius:10,x:g,y:f,fill:"red"})),b.push(i.a.createElement(W.Line,{key:E++,x:g,y:f,points:[0,0,12,0],rotation:180*-v/Math.PI,stroke:"black"}));for(var w=[],k=0;k<n/10;k++)w.push(i.a.createElement(W.Line,{key:12344+k,points:[Math.round(10*k)+.5,0,Math.round(10*k)+.5,a],stroke:"#f5f5f5",strokeWidth:1}));for(w.push(i.a.createElement(W.Line,{key:12344+k++,points:[0,0,10,10]})),E=0;E<a/10;E++)w.push(i.a.createElement(W.Line,{key:12344+k+E,points:[0,Math.round(10*E),n,Math.round(10*E)],stroke:"#ddd",strokeWidth:.5}));return i.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}},i.a.createElement(W.Stage,{className:"memory2d",width:n,height:a},i.a.createElement(W.Layer,{className:"gridLayer"},w),i.a.createElement(W.Layer,{className:"mapBoundary"},y),i.a.createElement(W.Layer,{className:"renderedObjects"},b),i.a.createElement(W.Layer,null,i.a.createElement(W.Text,{text:l,offsetX:-12,offsetY:-12,visible:null!=l,shadowEnabled:!0}))))}}]),a}(i.a.Component),F=a(87),K=a(107),Q=a(109),G=a(69),q=a(5),Y=a(8),J=a(335),X=a(88),Z=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,s=new Array(n),r=0;r<n;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).getRowClassName=function(t){var a=t.index,n=e.props,i=n.classes,s=n.onRowClick;return Object(q.a)(i.tableRow,i.flexContainer,Object(G.a)({},i.tableRowHover,-1!==a&&null!=s))},e.cellRenderer=function(t){var a=t.cellData,n=t.columnIndex,s=e.props,r=s.columns,o=s.classes,l=s.rowHeight,c=s.onRowClick;return i.a.createElement(J.a,{component:"div",className:Object(q.a)(o.tableCell,o.flexContainer,Object(G.a)({},o.noClick,null==c)),variant:"body",style:{height:l},align:null!=n&&r[n].numeric?"right":"left"},a)},e.headerRenderer=function(t){var a=t.label,n=t.columnIndex,s=e.props,r=s.headerHeight,o=s.columns,l=s.classes;return i.a.createElement(J.a,{component:"div",className:Object(q.a)(l.tableCell,l.flexContainer,l.noClick),variant:"head",style:{height:r},align:o[n].numeric?"right":"left"},i.a.createElement("span",null,a))},e}return Object(h.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.height,n=t.width,s=t.classes,r=t.columns,o=t.rowHeight,l=t.headerHeight,c=Object(Q.a)(t,["height","width","classes","columns","rowHeight","headerHeight"]);return i.a.createElement(X.c,Object.assign({height:a,width:n,rowHeight:o,gridStyle:{direction:"inherit"},size:"small",headerHeight:l,className:s.table},c,{rowClassName:this.getRowClassName}),r.map((function(t,a){var n=t.dataKey,r=Object(Q.a)(t,["dataKey"]);return i.a.createElement(X.b,Object.assign({key:n,headerRenderer:function(t){return e.headerRenderer(Object(K.a)(Object(K.a)({},t),{},{columnIndex:a}))},className:s.flexContainer,cellRenderer:e.cellRenderer,dataKey:n},r))})))}}]),a}(i.a.PureComponent);Z.defaultProps={headerHeight:48,rowHeight:36};var $=Object(Y.a)((function(e){return{flexContainer:{display:"flex",alignItems:"center",boxSizing:"border-box"},table:{"& .ReactVirtualized__Table__headerRow":{flip:!1,paddingRight:"rtl"===e.direction?"0 !important":void 0}},tableRow:{cursor:"pointer"},tableRowHover:{"&:hover":{backgroundColor:e.palette.action.hover}},tableCell:{flex:1},noClick:{cursor:"initial"}}}))(Z);function ee(e){var t=e.memoryManager,a=e.onShowMemoryDetail,n=Object(F.a)(t,2),s=n[0],r=n[1];return i.a.createElement(X.a,null,(function(e){var t=e.height,n=e.width;return i.a.createElement($,{height:t,width:n,rowCount:s(),rowGetter:function(e){var t,a=e.index;return{uuid:(t=r(a)).data[0],id:t.data[1],type:t.data[9],name:t.data[7]}},onRowClick:function(e){e.event,e.index;var t=e.rowData;t&&t.uuid&&a(t.uuid)},columns:[{flexGrow:1,width:1,label:"ID",dataKey:"id",numeric:!0},{flexGrow:5,width:5,label:"Type",dataKey:"type",numeric:!1},{flexGrow:5,width:5,label:"Name",dataKey:"name",numeric:!1}]})}))}var te=a(161);function ae(e,t){e.memories,e.named_abstractions;var a=e.reference_objects,n=e.triples,i=new Map(a.map((function(e){return[e[0],{data:e}]})));n&&n.forEach((function(e){var t=e[1],a=i.get(t);a&&(a.triples?a.triples.push(e):a.triples=[e])}));var s=[];if(null!=t&&t.length>0){var r,o=Object(te.a)(i.values());try{for(o.s();!(r=o.n()).done;){var l=r.value;JSON.stringify(l).includes(t)&&s.push(l)}}catch(c){o.e(c)}finally{o.f()}}else s=Array.from(i.values());return[function(){return s.length},function(e){return s[e]},function(e){return i.get(e)}]}var ne=a(329),ie=a(89);function se(e){return null===e.value||void 0===e.value?null:i.a.createElement(i.a.Fragment,null,i.a.createElement(ne.a,{item:!0,xs:4,s:4},i.a.createElement(ie.a,{variant:"button",align:"right"},e.title)),i.a.createElement(ne.a,{item:!0,xs:8,s:8},i.a.createElement(ie.a,{variant:"body1",align:"left"},e.value)))}var re=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){return Object(c.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"render",value:function(){var e=(0,Object(F.a)(this.props.memoryManager,3)[2])(this.props.uuid);return i.a.createElement(ne.a,{container:!0,spacing:2,style:{padding:"16px"}},i.a.createElement(ne.a,{item:!0,xs:11},i.a.createElement(ie.a,{variant:"h4",align:"left"},"Attributes")),i.a.createElement(se,{title:"UUID",value:e.data[0]}),i.a.createElement(se,{title:"ID",value:e.data[1]}),i.a.createElement(se,{title:"X",value:e.data[2]}),i.a.createElement(se,{title:"Y",value:e.data[3]}),i.a.createElement(se,{title:"Z",value:e.data[4]}),i.a.createElement(se,{title:"Yaw",value:e.data[5]}),i.a.createElement(se,{title:"Pitch",value:e.data[6]}),i.a.createElement(se,{title:"Type",value:e.data[9]}),i.a.createElement(se,{title:"Name",value:e.data[7]}),i.a.createElement(ne.a,{item:!0,xs:12},i.a.createElement(ie.a,{variant:"h4",align:"left"},"Triples")),i.a.createElement(ne.a,{item:!0,xs:4},i.a.createElement(ie.a,{variant:"button",align:"left"},"Predicate")),i.a.createElement(ne.a,{item:!0,xs:4},i.a.createElement(ie.a,{variant:"button",align:"left"},"Value")),i.a.createElement(ne.a,{item:!0,xs:4},i.a.createElement(ie.a,{variant:"button",align:"left"},"Confidence")),e.triples.map((function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement(ne.a,{item:!0,xs:4},i.a.createElement(ie.a,{variant:"body2",align:"left"},e[4])),i.a.createElement(ne.a,{item:!0,xs:4},i.a.createElement(ie.a,{variant:"body2",align:"left"},e[6])),i.a.createElement(ne.a,{item:!0,xs:4},i.a.createElement(ie.a,{variant:"body2",align:"left"},e[7])))})))}}]),a}(i.a.Component),oe=a(334),le=a(162),ce=a.n(le),he=a(330),ue=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={height:400,width:600,isLoaded:!1,memory:null,filter:"",showDetail:!1,detailUUID:null},n.state=n.initialState,n.outer_div=i.a.createRef(),n.resizeHandler=n.resizeHandler.bind(Object(p.a)(n)),n}return Object(h.a)(a,[{key:"resizeHandler",value:function(){if(null!=this.outer_div&&null!=this.outer_div.current){var e=this.outer_div.current,t=e.clientHeight,a=e.clientWidth;(void 0!==t&&t!==this.state.height||void 0!==a&&a!==this.state.width)&&this.setState({height:t,width:a})}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),void 0!==this.props.glContainer&&this.props.glContainer.on("resize",this.resizeHandler)}},{key:"componentDidUpdate",value:function(e,t){this.resizeHandler()}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return i.a.createElement("p",null,"Loading");var t=this.state,a=t.height,n=t.width,s=t.memory,r=t.isLoaded;if(0===a&&0===n)return i.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}});if(!r)return i.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}},"Loading...");var o=Object(z.a)({palette:{type:"dark"}}),l=new ae(s,this.state.filter),c=this.state.height-24,h=this.state.width-24,u=function(){e.setState({showDetail:!1})};return i.a.createElement(N.a,{theme:o},i.a.createElement(M.a,{style:{borderBlockColor:"white"},color:"primary",id:"outlined-uncontrolled",label:"Search",margin:"dense",variant:"outlined",onChange:function(t){e.setState({filter:t.target.value})}}),i.a.createElement(ee,{height:c,width:h,memoryManager:l,onShowMemoryDetail:function(t){e.setState({detailUUID:t,showDetail:!0})}}),i.a.createElement(oe.a,{anchor:"right",open:this.state.showDetail,onClose:function(){u()}},i.a.createElement("div",{style:{width:450}},i.a.createElement(k.a,{onClick:function(){return u()}},i.a.createElement(ce.a,null)),i.a.createElement(he.a,null),i.a.createElement(re,{memoryManager:l,uuid:this.state.detailUUID}))))}}]),a}(i.a.Component),de=a(50),me=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onResize=n.onResize.bind(Object(p.a)(n)),n.initialState={height:e.height,width:e.width,rgb:null,depth:null},n.state=n.initialState,n}return Object(h.a)(a,[{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,s=e.depth,r=this.props,o=r.offsetW,l=r.offsetH,c=n;return null===n&&null==s?i.a.createElement(de.a,{default:{x:o,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},i.a.createElement("p",null,"Loading...")):("depth"===this.props.type&&(c=s),i.a.createElement(de.a,{default:{x:o,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},i.a.createElement(W.Stage,{width:a,height:t},i.a.createElement(W.Layer,null,i.a.createElement(W.Image,{image:c,width:a,height:t})))))}}]),a}(i.a.Component),pe=(a(279),a(280),function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={selectedTags:[],suggestions:[],currentValue:""},n.inputRef=i.a.createRef(),n}return Object(h.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"tag-selector"},i.a.createElement("div",{className:"tag-holder"},this.state.selectedTags.map((function(t){return i.a.createElement("span",{class:"tag-selected"},t,i.a.createElement("button",{onClick:function(){e.removeTag(t)}},"X"))}))),i.a.createElement("input",{type:"text",placeholder:"Tags (press Enter to add)",ref:this.inputRef,onChange:this.update.bind(this),onKeyDown:this.keyDown.bind(this)}),i.a.createElement("div",{className:"tag-suggestions"},this.state.suggestions.map((function(t){return i.a.createElement("span",null,i.a.createElement("button",{onClick:function(){e.addTag(t)}},t))}))))}},{key:"update",value:function(e){var t=this,a=this.inputRef.current.value;0!==a.length?this.setState({suggestions:this.props.tags.filter((function(e){return e.toLowerCase().slice(0,a.length)===a&&-1===t.state.selectedTags.indexOf(e)}))}):this.setState({suggestions:[]})}},{key:"removeTag",value:function(e){var t=this;this.setState({selectedTags:this.state.selectedTags.filter((function(t){return t!==e}))},(function(){t.props.update(t.state.selectedTags)}))}},{key:"addTag",value:function(e){var t=this;e=e.toLowerCase(),this.setState({selectedTags:this.state.selectedTags.concat(e),suggestions:[]},(function(){t.props.update(t.state.selectedTags)})),this.inputRef.current.value=""}},{key:"keyDown",value:function(e){"Enter"===e.key&&""!==this.inputRef.current.value.trim()&&this.addTag(this.inputRef.current.value),this.setState({currentValue:this.inputRef.current.value})}}]),a}(i.a.Component)),ge=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).labels=[],n.tags=[],n.nameRef=i.a.createRef(),n}return Object(h.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"data-entry-root",style:{top:this.props.y+"px",left:this.props.x+"px",position:"fixed"}},i.a.createElement("input",{placeholder:"Object Name",ref:this.nameRef}),i.a.createElement(pe,{tags:this.labels,update:function(t){return e.tags=t}}),i.a.createElement("button",{className:"data-entry-submit",onClick:this.submit.bind(this)},"Submit"))}},{key:"submit",value:function(){var e=this.nameRef.current.value.trim();0!==e.length?this.tags.length<2?alert("Please enter at least 2 descriptive tags for the object. Examples include: color, shape, size, orientation, etc."):this.props.onSubmit({name:e.toLowerCase(),tags:this.tags}):alert("You must enter the object's name")}}]),a}(i.a.Component),fe=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).update=n.update.bind(Object(p.a)(n)),n.onClick=n.onClick.bind(Object(p.a)(n)),n.onMouseMove=n.onMouseMove.bind(Object(p.a)(n)),n.keyDown=n.keyDown.bind(Object(p.a)(n)),n.drawPoint=n.drawPoint.bind(Object(p.a)(n)),n.drawLine=n.drawLine.bind(Object(p.a)(n)),n.localToImage=n.localToImage.bind(Object(p.a)(n)),n.imageToLocal=n.imageToLocal.bind(Object(p.a)(n)),n.shiftViewBy=n.shiftViewBy.bind(Object(p.a)(n)),n.isDrawingPolygon=!1,n.lastMouse={x:0,y:0},n.dragging=!1,n.canvasRef=i.a.createRef(),n.zoomPixels=300,n.pointSize=10,n}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.points=[],this.img=this.props.img,this.Offset={x:0,y:0},this.baseScale=Math.min(this.canvas.width/this.img.width,this.canvas.height/this.img.height),this.scale=this.baseScale,this.update()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("p",null,"Please trace the ",this.props.object),i.a.createElement("canvas",{ref:this.canvasRef,width:"500px",height:"500px",tabIndex:"0",onClick:this.onClick,onMouseMove:this.onMouseMove,onKeyDown:this.keyDown}))}},{key:"update",value:function(){var e=this;if(this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y),this.ctx.drawImage(this.img,0,0),"Enter"!==this.lastKey){for(var t=0;t<this.points.length-1;t++)this.drawLine(this.points[t],this.points[t+1]);this.points.length>0&&!this.dragging&&this.drawLine(this.points[this.points.length-1],this.localToImage(this.lastMouse)),this.points.forEach((function(t){e.drawPoint(t)}))}else{if(this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.baseScale,0,0,this.baseScale,0,0),this.ctx.drawImage(this.img,0,0),this.points.length<3)return;var a=new Path2D;a.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n++)a.lineTo(this.points[n].x,this.points[n].y);a.closePath(),this.ctx.fillStyle="rgba(0,200,0,.5)",this.ctx.fill(a,"evenodd")}}},{key:"updateZoom",value:function(){this.scale=Math.min(this.canvas.width/this.zoomPixels,this.canvas.height/this.zoomPixels),0!==this.points.length&&(this.Offset={x:-(this.points[this.points.length-1].x-this.zoomPixels/2)*this.scale,y:-(this.points[this.points.length-1].y-this.zoomPixels/2)*this.scale})}},{key:"onMouseMove",value:function(e){var t=this.canvas.getBoundingClientRect();this.lastMouse={x:e.clientX-t.left,y:e.clientY-t.top+1},this.dragging&&(this.points[this.draggingIndex]=this.localToImage(this.lastMouse)),this.update()}},{key:"onClick",value:function(e){if(this.dragging)return this.dragging=!1,void this.update();for(var t=null,a=0;a<this.points.length;a++)this.distance(this.points[a],this.localToImage(this.lastMouse))<this.pointSize/2&&(t=a);if(null!=t)return this.dragging=!0,this.draggingIndex=t,void this.update();"Enter"!==this.lastKey&&this.points.push(this.localToImage(this.lastMouse)),this.updateZoom(),this.isDrawingPolygon||(this.points.pop(),this.isDrawingPolygon=!0),this.update(),this.lastKey="Mouse"}},{key:"keyDown",value:function(e){switch(e.key){case" ":this.points.length>0&&this.points.pop();break;case"w":this.shiftViewBy(0,10);break;case"a":this.shiftViewBy(10,0);break;case"s":this.shiftViewBy(0,-10);break;case"d":this.shiftViewBy(-10,0);break;case"Enter":"Enter"===this.lastKey&&(this.lastKey=null,this.props.submitCallback(this.points));break;case"=":this.zoomPixels-=10,this.updateZoom()}this.lastKey=e.key,this.update()}},{key:"drawPoint",value:function(e){this.ctx.fillStyle="black",this.distance(e,this.localToImage(this.lastMouse))<this.pointSize/2&&(this.ctx.fillStyle="green"),this.ctx.fillRect(e.x-2.5,e.y-2.5,5,5)}},{key:"drawLine",value:function(e,t){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}},{key:"localToImage",value:function(e){return{x:(e.x-this.Offset.x)/this.scale,y:(e.y-this.Offset.y)/this.scale}}},{key:"imageToLocal",value:function(e){return{x:e.x*this.scale+this.Offset.x,y:e.y*this.scale+this.Offset.y}}},{key:"resetView",value:function(){this.Offset={x:0,y:0},this.scale=Math.min(this.canvas.width/this.img.width,this.canvas.height/this.img.height)}},{key:"shiftViewBy",value:function(e,t){this.Offset={x:this.Offset.x+e,y:this.Offset.y+t}}},{key:"distance",value:function(e,t){return 2*Math.max(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}}]),a}(i.a.Component),ve=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).update=n.update.bind(Object(p.a)(n)),n.drawLine=n.drawLine.bind(Object(p.a)(n)),n.canvasRef=i.a.createRef(),n.imgRef=i.a.createRef(),n}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.Offset={x:0,y:0},this.baseScale=this.canvas.width/this.props.img.width,this.scale=this.baseScale,this.canvas.height=this.props.img.height*this.baseScale,this.update()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("canvas",{ref:this.canvasRef,width:"500px",height:"500px",tabIndex:"0",onClick:this.props.onClick,onMouseMove:this.onMouseMove,onKeyDown:this.keyDown}))}},{key:"update",value:function(){this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y),this.ctx.drawImage(this.props.img,0,0);for(var e=0;e<this.props.objects.length;e++){var t=this.props.pointMap[this.props.objects[e]];if(t){var a=this.props.colors[e%this.props.colors.length];a?this.drawRegion(t,a):this.drawRegion(t,"rgba(0,200,0,.5)")}}}},{key:"drawLine",value:function(e,t){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}},{key:"drawRegion",value:function(e,t){if(!(e.length<3)){var a=new Path2D;a.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)a.lineTo(e[n].x,e[n].y);a.closePath(),this.ctx.fillStyle=t,this.ctx.fill(a,"evenodd")}}}]),a}(i.a.Component),be=["rgba(0,200,0,.5)","rgba(200,0,0,.5)","rgba(0,0,200,.5)","rgba(200,200,0,.5)","rgba(0,200,200,.5)","rgba(200,0,200,.5)","rgba(150,50,50,.5)","rgba(255, 153, 0, .5)","rgba(128,0,128,.5)","rgba(0,204,255,.5)","rgba(153,204,0,.5)"],ye=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).state={objectIds:[],currentMode:"select",currentOverlay:null},n.currentId=0,n.nameMap={},n.pointMap={},n.propertyMap={},n.registerClick=n.registerClick.bind(Object(p.a)(n)),void 0!==n.props.image?n.image=n.props.image:(n.image=new Image,n.image.onload=function(){n.forceUpdate()},n.image.src=n.props.imgUrl),n.overtime=!1,setInterval((function(){n.overtime=!0}),6e4*window.MINUTES),n}return Object(h.a)(a,[{key:"render",value:function(){var e=this;return"draw_polygon"!==this.state.currentMode?i.a.createElement("div",null,i.a.createElement("p",null,"Label and outline as ",i.a.createElement("b",null,"many objects as possible.")," Click an object in the image to start. ",this.state.objectIds.length," ","object(s) labeled."),this.state.currentOverlay,i.a.createElement(ve,{img:this.image,objects:this.state.objectIds,pointMap:this.pointMap,colors:be,onClick:function(t){return e.registerClick(t.clientX,t.clientY)}}),i.a.createElement("button",{onClick:this.submit.bind(this)},"Finished annotating objects")):i.a.createElement(fe,{img:this.image,object:this.drawing_data.name,submitCallback:this.drawingFinished.bind(this)})}},{key:"registerClick",value:function(e,t){if("select"===this.state.currentMode){var a=i.a.createElement(ge,{x:e,y:t,onSubmit:this.dataEntered.bind(this)});this.setState({currentMode:"fill_data",currentOverlay:a})}}},{key:"dataEntered",value:function(e){this.drawing_data=e,this.setState({currentMode:"draw_polygon",currentOverlay:null})}},{key:"drawingFinished",value:function(e){var t=this;this.propertyMap[this.currentId]=this.drawing_data.tags,this.pointMap[this.currentId]=e,this.nameMap[this.currentId]=this.drawing_data.name,this.setState({currentMode:"select",objectIds:this.state.objectIds.splice(0).concat(this.currentId)},(function(){t.currentId+=1}))}},{key:"submit",value:function(){if(this.state.objectIds.length<window.MIN_OBJECTS)alert("Label more objects, or your HIT may be rejected");else{var e={nameMap:this.nameMap,propertyMap:this.propertyMap,pointMap:this.pointMap};this.props.stateManager.socket.emit("saveObjectAnnotation",e),this.props.not_turk}}}]),a}(i.a.Component),Ee=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).initialState={image:void 0},n.state=n.initialState,n}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return void 0===this.state.image?null:i.a.createElement(ye,{image:this.state.image,not_turk:!0,stateManager:this.props.stateManager})}}]),a}(i.a.Component),we=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onResize=n.onResize.bind(Object(p.a)(n)),n.onFixup=n.onFixup.bind(Object(p.a)(n)),n.initialState={height:e.height,width:e.width,rgb:null,objects:null},n.state=n.initialState,n}return Object(h.a)(a,[{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"onFixup",value:function(){if(this.props.stateManager){var e=this.props.stateManager,t=void 0;if(e.refs.forEach((function(e){e instanceof Ee&&(t=e)})),void 0!==t){t.setState({image:this.state.rgb});for(var a=e.dashboardLayout,n=0;n<a._getAllContentItems().length;n++)if("ObjectFixup"===a._getAllContentItems()[n].config.component){var i=a._getAllContentItems()[n];i.parent.setActiveContentItem(i)}}}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,s=e.objects,r=this.props,o=r.offsetW,l=r.offsetH;if(null===n)return i.a.createElement(de.a,{default:{x:o,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},i.a.createElement("p",null,"Loading..."));var c=[],h=s;null===s&&(h=[]);var u=0;return h.forEach((function(e){var a=e.id,n=String(a).concat(e.label),s=e.properties,r=n.concat(s).split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0),o=U.a[Math.abs(r%U.a.length)],l=t/512,h=parseInt(e.bbox[0]*l),d=parseInt(e.bbox[1]*l),m=parseInt(e.bbox[2]*l),p=parseInt(e.bbox[3]*l)-d,g=m-h;c.push(i.a.createElement(W.Rect,{key:u,x:h,y:d,width:g,height:p,fillEnabled:!1,stroke:o})),c.push(i.a.createElement(W.Text,{key:[u++,n],text:n.concat("\n",s),x:h,y:d,fill:o,fontSize:10}))})),i.a.createElement(de.a,{default:{x:o,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},i.a.createElement(W.Stage,{width:a,height:t},i.a.createElement(W.Layer,null,i.a.createElement(W.Image,{image:n,width:a,height:t}),c)),i.a.createElement("button",{onClick:this.onFixup},"Fix"))}}]),a}(i.a.Component),ke=a(331),xe=[["left_ear","left_eye"],["right_ear","right_eye"],["left_eye","right_eye"],["left_eye","nose"],["right_eye","nose"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"],["right_hip","left_hip"],["right_shoulder","left_shoulder"]],Oe=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onResize=n.onResize.bind(Object(p.a)(n)),n.initialState={height:e.height,width:e.width,rgb:null,humans:null},n.state=n.initialState,n}return Object(h.a)(a,[{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,s=e.humans,r=this.props,o=r.offsetW,l=r.offsetH;if(null===n)return i.a.createElement(de.a,{default:{x:o,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},i.a.createElement("p",null,"Loading..."));var c=[],h=0,u=0;return s.forEach((function(e){var a=t/512,n=ke.a[h++];h===ke.a.length&&(h=0),xe.forEach((function(t){var s=e.keypoints[t[0]],r=e.keypoints[t[1]],o=[parseInt(s[0]*a),parseInt(s[1]*a),parseInt(r[0]*a),parseInt(r[1]*a)];c.push(i.a.createElement(W.Line,{key:u++,points:o,stroke:n}))}))})),i.a.createElement(de.a,{default:{x:o,y:l,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},i.a.createElement(W.Stage,{width:a,height:t},i.a.createElement(W.Layer,null,i.a.createElement(W.Image,{image:n,width:a,height:t}),c)))}}]),a}(i.a.Component),Me=new(function(){function e(){Object(c.a)(this,e),this.refs=[],this.socket=null,this.default_url="http://localhost:8000",this.connected=!1,this.initialMemoryState={objects:new Map,humans:new Map,chatResponse:{},chats:[{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1}]},this.processSensorPayload=this.processSensorPayload.bind(this),this.processMemoryState=this.processMemoryState.bind(this),this.setChatResponse=this.setChatResponse.bind(this),this.setConnected=this.setConnected.bind(this),this.updateStateManagerMemory=this.updateStateManagerMemory.bind(this),this.keyHandler=this.keyHandler.bind(this),this.updateVoxelWorld=this.updateVoxelWorld.bind(this),this.setVoxelWorldInitialState=this.setVoxelWorldInitialState.bind(this),this.memory=this.initialMemoryState,this.processRGB=this.processRGB.bind(this),this.processDepth=this.processDepth.bind(this),this.processObjects=this.processObjects.bind(this),this.showAssistantReply=this.showAssistantReply.bind(this),this.default_url=window.location.href,this.setUrl(this.default_url);var t=localStorage.getItem("server_url");"undefined"!==t&&void 0!==t&&null!==t||(t=this.default_url),this.setUrl(t),this.fps_time=performance.now()}return Object(h.a)(e,[{key:"setDefaultUrl",value:function(){localStorage.clear(),this.setUrl(this.default_url)}},{key:"setUrl",value:function(e){this.url=e,localStorage.setItem("server_url",e),this.restart(this.url)}},{key:"restart",value:function(e){var t=this;this.socket=A.a.connect(e,{transports:["polling","websocket"]});var a=this.socket;a.on("reconnect_attempt",(function(){a.io.opts.transports=["polling","websocket"]})),a.on("connect",(function(e){console.log("connect event"),t.setConnected(!0),t.socket.emit("get_memory_objects")})),a.on("reconnect",(function(e){console.log("reconnect event"),t.setConnected(!0),t.socket.emit("get_memory_objects")})),a.on("disconnect",(function(e){console.log("disconnect event"),t.setConnected(!1),t.memory=t.initialMemoryState,t.refs.forEach((function(e){e.setState(e.initialState),e.forceUpdate()})),console.log("disconnected")})),a.on("setChatResponse",this.setChatResponse),a.on("sensor_payload",this.processSensorPayload),a.on("memoryState",this.processMemoryState),a.on("updateState",this.updateStateManagerMemory),a.on("rgb",this.processRGB),a.on("depth",this.processDepth),a.on("objects",this.processObjects),a.on("updateVoxelWorldState",this.updateVoxelWorld),a.on("setVoxelWorldInitialState",this.setVoxelWorldInitialState),a.on("showAssistantReply",this.showAssistantReply)}},{key:"updateStateManagerMemory",value:function(e){this.memory=e.memory,this.refs.forEach((function(e){e.forceUpdate()}))}},{key:"setConnected",value:function(e){this.connected=e,this.refs.forEach((function(t){t instanceof D&&t.setState({connected:e})}))}},{key:"setChatResponse",value:function(e){this.memory.chats=e.allChats,this.memory.chatResponse[e.chat]=e.chatResponse,this.refs.forEach((function(t){t instanceof S&&t.setState({status:e.status}),t instanceof L&&t.forceUpdate()}))}},{key:"updateVoxelWorld",value:function(e){this.refs.forEach((function(t){t instanceof _&&(console.log("update Voxel World with "+e.world_state),t.setState({world_state:e.world_state,status:e.status}))}))}},{key:"setVoxelWorldInitialState",value:function(e){this.refs.forEach((function(t){t instanceof _&&(console.log("set Voxel World Initial state: "+e.world_state),t.setState({world_state:e.world_state,status:e.status}))}))}},{key:"showAssistantReply",value:function(e){this.refs.forEach((function(t){t instanceof S&&(console.log("set assistant reply"),t.setState({agent_reply:e.agent_reply}))}))}},{key:"keyHandler",value:function(e){var t=[];for(var a in e){var n=e[a];a=parseInt(a),!0===n&&(38===a&&t.push("MOVE_FORWARD"),40===a&&t.push("MOVE_BACKWARD"),37===a&&t.push("MOVE_LEFT"),39===a&&t.push("MOVE_RIGHT"),49===a&&t.push("PAN_LEFT"),50===a&&t.push("PAN_RIGHT"),51===a&&t.push("TILT_UP"),52===a&&t.push("TILT_DOWN"))}t.length>0&&this.socket.emit("command",t)}},{key:"processMemoryState",value:function(e){this.refs.forEach((function(t){t instanceof ue&&t.setState({isLoaded:!0,memory:e})}))}},{key:"processRGB",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e,this.refs.forEach((function(e){e instanceof me&&"rgb"===e.props.type&&e.setState({isLoaded:!0,rgb:t})}))}},{key:"processDepth",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e,this.refs.forEach((function(e){e instanceof me&&"depth"===e.props.type&&e.setState({isLoaded:!0,depth:t})}))}},{key:"processObjects",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e.image.rgb,this.refs.forEach((function(a){a instanceof we&&a.setState({isLoaded:!0,objects:e.objects,rgb:t})}))}},{key:"processSensorPayload",value:function(e){var t=this,a=performance.now(),n=1e3/(a-this.fps_time);this.fps_time=a;var i=new Image;i.src="data:image/webp;base64,"+e.image.rgb;var s=new Image;s.src="data:image/webp;base64,"+e.image.depth;var r=new Image;return-1!==e.object_image&&void 0!==e.object_image&&(r.src="data:image/webp;base64,"+e.object_image.rgb),this.refs.forEach((function(a){a instanceof B?a.setState({isLoaded:!0,memory:t.memory,bot_xyz:[e.x,e.y,e.yaw],obstacle_map:e.map}):a instanceof D?a.setState({fps:n}):a instanceof me?a.setState({isLoaded:!0,rgb:i,depth:s}):(a instanceof we||a instanceof Oe)&&-1!==e.object_image&&void 0!==e.object_image&&a.setState({isLoaded:!0,rgb:r,objects:e.objects,humans:e.humans})})),"OK"}},{key:"connect",value:function(e){this.refs.push(e)}}]),e}());a(281);window.React=i.a,window.ReactDOM=r.a;var je={settings:{showPopoutIcon:!1},content:[{type:"row",content:[{type:"column",content:[{type:"stack",content:[{title:"Interact",type:"react-component",component:"InteractApp",props:{stateManager:Me}}]},{type:"stack",content:[{title:"Chat History",type:"react-component",component:"History",props:{stateManager:Me}}]}]},{type:"column",content:[{type:"stack",content:[{title:"VoxelWorld",type:"react-component",component:"VoxelWorld",props:{stateManager:Me}}],height:60},{type:"stack",content:[{title:"Info",type:"react-component",component:"TurkInfo",props:{stateManager:Me}}]}]}]}]},Se=new l.a(je);Se.registerComponent("MainPane",C),Se.registerComponent("Settings",D),Se.registerComponent("TurkInfo",H),Se.registerComponent("History",L),Se.registerComponent("VoxelWorld",_),Se.registerComponent("InteractApp",S),Se.init(),Me.dashboardLayout=Se}},[[174,1,2]]]);