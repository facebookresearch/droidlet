(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[2],{166:function(e,t,a){},167:function(e,t,a){},168:function(e,t,a){},169:function(e,t,a){},172:function(e,t,a){},177:function(e,t,a){},30:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(145),r=a.n(s),o=a(56),l=a(97),c=a(45),h=a(65),u=a(77),d=a(55),m=a(94),p=a(76),g=a(95),f=new(function(){function e(){Object(n.a)(this,e),this.refs=[],this.socket=null,this.default_url="http://localhost:8000",this.connected=!1,this.initialMemoryState={objects:new Map,humans:new Map,chatResponse:{},chats:[{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1},{msg:"",failed:!1}],timelineHandshake:""},this.processSensorPayload=this.processSensorPayload.bind(this),this.processMemoryState=this.processMemoryState.bind(this),this.setChatResponse=this.setChatResponse.bind(this),this.setConnected=this.setConnected.bind(this),this.updateStateManagerMemory=this.updateStateManagerMemory.bind(this),this.keyHandler=this.keyHandler.bind(this),this.memory=this.initialMemoryState,this.processRGB=this.processRGB.bind(this),this.processDepth=this.processDepth.bind(this),this.processObjects=this.processObjects.bind(this),this.returnTimelineHandshake=this.returnTimelineHandshake.bind(this);var t=localStorage.getItem("server_url");"undefined"!==t&&void 0!==t&&null!==t||(t=this.default_url),this.setUrl(t),this.fps_time=performance.now()}return Object(i.a)(e,[{key:"setDefaultUrl",value:function(){localStorage.clear(),this.setUrl(this.default_url)}},{key:"setUrl",value:function(e){this.url=e,localStorage.setItem("server_url",e),this.restart(this.url)}},{key:"restart",value:function(e){var t=this;this.socket=r.a.connect(e,{transports:["polling","websocket"]});var a=this.socket;a.on("reconnect_attempt",(function(){a.io.opts.transports=["polling","websocket"]})),a.on("connect",(function(e){console.log("connect event"),t.setConnected(!0),t.socket.emit("get_memory_objects")})),a.on("reconnect",(function(e){console.log("reconnect event"),t.setConnected(!0),t.socket.emit("get_memory_objects")})),a.on("disconnect",(function(e){console.log("disconnect event"),t.setConnected(!1),t.memory=t.initialMemoryState,t.refs.forEach((function(e){e.setState(e.initialState),e.forceUpdate()})),console.log("disconnected")})),a.on("setChatResponse",this.setChatResponse),a.on("sensor_payload",this.processSensorPayload),a.on("memoryState",this.processMemoryState),a.on("updateState",this.updateStateManagerMemory),a.on("rgb",this.processRGB),a.on("depth",this.processDepth),a.on("objects",this.processObjects),a.on("returnTimelineHandshake",this.returnTimelineHandshake)}},{key:"updateStateManagerMemory",value:function(e){this.memory=e.memory,this.refs.forEach((function(e){e.forceUpdate()}))}},{key:"setConnected",value:function(e){this.connected=e,this.refs.forEach((function(t){t instanceof h.a&&t.setState({connected:e})}))}},{key:"setChatResponse",value:function(e){this.memory.chats=e.allChats,this.memory.chatResponse[e.chat]=e.chatResponse,this.refs.forEach((function(t){t instanceof p.a&&t.setState({status:e.status}),t instanceof m.a&&t.forceUpdate()}))}},{key:"returnTimelineHandshake",value:function(e){this.memory.timelineHandshake=e,this.refs.forEach((function(e){e instanceof g.a&&e.forceUpdate()}))}},{key:"keyHandler",value:function(e){var t=[],a=[];for(var n in e){var i=e[n];n=parseInt(n),a.push(n),!0===i&&(38===n&&t.push("MOVE_FORWARD"),40===n&&t.push("MOVE_BACKWARD"),37===n&&t.push("MOVE_LEFT"),39===n&&t.push("MOVE_RIGHT"),49===n&&t.push("PAN_LEFT"),50===n&&t.push("PAN_RIGHT"),51===n&&t.push("TILT_UP"),52===n&&t.push("TILT_DOWN"))}if(t.length>0)for(var s in this.socket.emit("movement command",t),a)e[a[s]]=!1}},{key:"buttonHandler",value:function(e){e.length>0&&this.socket.emit("movement command",e)}},{key:"processMemoryState",value:function(e){this.refs.forEach((function(t){t instanceof l.a&&t.setState({isLoaded:!0,memory:e})}))}},{key:"processRGB",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e,this.refs.forEach((function(e){e instanceof c.a&&"rgb"===e.props.type&&e.setState({isLoaded:!0,rgb:t})}))}},{key:"processDepth",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e,this.refs.forEach((function(e){e instanceof c.a&&"depth"===e.props.type&&e.setState({isLoaded:!0,depth:t})}))}},{key:"processObjects",value:function(e){var t=new Image;t.src="data:image/webp;base64,"+e.image.rgb,this.refs.forEach((function(a){a instanceof u.a&&a.setState({isLoaded:!0,objects:e.objects,rgb:t})}))}},{key:"processSensorPayload",value:function(e){var t=this,a=performance.now(),n=1e3/(a-this.fps_time);this.fps_time=a;var i=new Image;i.src="data:image/webp;base64,"+e.image.rgb;var s=new Image;s.src="data:image/webp;base64,"+e.image.depth;var r=new Image;return-1!==e.object_image&&void 0!==e.object_image&&(r.src="data:image/webp;base64,"+e.object_image.rgb),this.refs.forEach((function(a){a instanceof o.a?a.setState({isLoaded:!0,memory:t.memory,bot_xyz:[e.x,e.y,e.yaw],obstacle_map:e.map}):a instanceof h.a?a.setState({fps:n}):a instanceof c.a?a.setState({isLoaded:!0,rgb:i,depth:s}):(a instanceof u.a||a instanceof d.a)&&-1!==e.object_image&&void 0!==e.object_image&&a.setState({isLoaded:!0,rgb:r,objects:e.objects,humans:e.humans})})),"OK"}},{key:"connect",value:function(e){this.refs.push(e)}},{key:"disconnect",value:function(e){this.refs=this.refs.filter((function(t){return t!==e}))}}]),e}());t.a=f},376:function(e,t,a){e.exports=a(384)},378:function(e,t,a){},382:function(e,t,a){},384:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),s=a(19),r=a.n(s),o=(a(377),a(7)),l=a(8),c=a(10),h=a(9),u=a(432),d=a(433),m=a(435),p=(a(378),function(e){Object(c.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state=e.state,n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement(d.a,{className:"Navbar"},i.a.createElement(m.a,null,i.a.createElement("button",{className:"button",onClick:function(){return e.props.paneHandler("home")}},"Home"),i.a.createElement("button",{className:"button",onClick:function(){return e.props.paneHandler("navigation")}},"Navigation"),i.a.createElement("button",{className:"button",onClick:function(){return e.props.paneHandler("settings")}},"Settings")))}}]),a}(i.a.Component)),g=a(430),f=a(431),v=a(45),b=a(55),y=a(30),E=a(76),k=a(56),w=function(e){Object(c.a)(a,e);var t=Object(h.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(g.a,null,i.a.createElement(f.a,null,"Video Feed 1",i.a.createElement(v.a,{type:"rgb",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0})),i.a.createElement(f.a,null,"Memory 2d",i.a.createElement(k.a,{stateManager:y.a,isMobile:!0,dimensions:this.props.imageWidth}))),i.a.createElement(g.a,null,i.a.createElement(f.a,null,"Video Feed 2",i.a.createElement(v.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0})),i.a.createElement(f.a,null,"Video Feed 3",i.a.createElement(b.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0}))),i.a.createElement(g.a,null,i.a.createElement(E.a,{stateManager:y.a,isMobile:!0})))}}]),a}(i.a.Component),M=(a(382),function(e){Object(c.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={commands:[]},n.intervalId=void 0,n}return Object(l.a)(a,[{key:"componentDidMount",value:function(){this.intervalId=setInterval(this.sendAndClearCommands.bind(this),33.33)}},{key:"componentWillUnmount",value:function(){this.intervalId&&clearInterval(this.intervalId)}},{key:"addCommand",value:function(e){var t=this.state.commands;t.push(e),this.setState({commands:t})}},{key:"sendAndClearCommands",value:function(){this.state&&(y.a.buttonHandler(this.state.commands),this.setState({commands:[]}))}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"container"},i.a.createElement("button",{className:"directionButton left",onClick:function(){return e.addCommand("MOVE_LEFT")}},"LEFT"),i.a.createElement("button",{className:"directionButton up",onClick:function(){return e.addCommand("MOVE_FORWARD")}},"UP"),i.a.createElement("button",{className:"directionButton down",onClick:function(){return e.addCommand("MOVE_DOWN")}},"DOWN"),i.a.createElement("button",{className:"directionButton right",onClick:function(){return e.addCommand("MOVE_RIGHT")}},"RIGHT"))}}]),a}(i.a.Component)),O=function(e){Object(c.a)(a,e);var t=Object(h.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(g.a,null,i.a.createElement(f.a,null,"Video Feed 1",i.a.createElement(v.a,{type:"rgb",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0})),i.a.createElement(f.a,null,"Memory 2d",i.a.createElement(k.a,{stateManager:y.a,isMobile:!0,dimensions:this.props.imageWidth}))),i.a.createElement(g.a,null,i.a.createElement(f.a,null,"Video Feed 2",i.a.createElement(v.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0})),i.a.createElement(f.a,null,"Video Feed 3",i.a.createElement(b.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0}))),i.a.createElement(M,null))}}]),a}(i.a.Component),x=a(65),j=function(e){Object(c.a)(a,e);var t=Object(h.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(l.a)(a,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(g.a,null,i.a.createElement(f.a,null,"Video Feed 1",i.a.createElement(v.a,{type:"rgb",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0})),i.a.createElement(f.a,null,"Memory 2d",i.a.createElement(k.a,{stateManager:y.a,isMobile:!0,dimensions:this.props.imageWidth}))),i.a.createElement(g.a,null,i.a.createElement(f.a,null,"Video Feed 2",i.a.createElement(v.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0})),i.a.createElement(f.a,null,"Video Feed 3",i.a.createElement(b.a,{type:"depth",height:this.props.imageWidth,width:this.props.imageWidth,offsetH:0,offsetW:0,stateManager:y.a,isMobile:!0}))),i.a.createElement(x.a,{stateManager:y.a,isMobile:!0}))}}]),a}(i.a.Component),S=function(e){Object(c.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(o.a)(this,a);var i=window.innerWidth;return(n=t.call(this,e)).state={screen:"home",imageWidth:i/2-25},n}return Object(l.a)(a,[{key:"paneHandler",value:function(e){this.setState({screen:e})}},{key:"render",value:function(){var e;return e="home"===this.state.screen?i.a.createElement(w,{imageWidth:this.state.imageWidth}):"navigation"===this.state.screen?i.a.createElement(O,{imageWidth:this.state.imageWidth}):i.a.createElement(j,{imageWidth:this.state.imageWidth}),i.a.createElement(u.a,{fluid:!0},e,i.a.createElement(p,{paneHandler:this.paneHandler.bind(this)}))}}]),a}(i.a.Component);r.a.render(i.a.createElement(S,null),document.getElementById("root"))},45:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(12),r=a(10),o=a(9),l=a(0),c=a.n(l),h=a(50),u=a(14),d=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onResize=i.onResize.bind(Object(s.a)(i)),i.initialState={height:e.height,width:e.width,rgb:null,depth:null},i.state=i.initialState,i}return Object(i.a)(a,[{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,i=e.depth,s=this.props,r=s.offsetW,o=s.offsetH,l=s.isMobile,d=n;return null===n&&null==i?l?c.a.createElement("p",null,"Loading..."):c.a.createElement(h.a,{default:{x:r,y:o,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement("p",null,"Loading...")):("depth"===this.props.type&&(d=i),l?c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:d,width:a,height:t}))):c.a.createElement(h.a,{default:{x:r,y:o,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:d,width:a,height:t})))))}}]),a}(c.a.Component);t.a=d},55:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(12),r=a(10),o=a(9),l=a(0),c=a.n(l),h=a(50),u=a(14),d=a(154),m=[["left_ear","left_eye"],["right_ear","right_eye"],["left_eye","right_eye"],["left_eye","nose"],["right_eye","nose"],["right_shoulder","right_elbow"],["right_elbow","right_wrist"],["left_shoulder","left_elbow"],["left_elbow","left_wrist"],["left_shoulder","left_hip"],["left_hip","left_knee"],["left_knee","left_ankle"],["right_shoulder","right_hip"],["right_hip","right_knee"],["right_knee","right_ankle"],["right_hip","left_hip"],["right_shoulder","left_shoulder"]],p=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onResize=i.onResize.bind(Object(s.a)(i)),i.initialState={height:e.height,width:e.width,rgb:null,humans:null},i.state=i.initialState,i}return Object(i.a)(a,[{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,i=e.humans,s=this.props,r=s.offsetW,o=s.offsetH,l=s.isMobile;if(null===n)return l?c.a.createElement("p",null,"Loading... "):c.a.createElement(h.a,{default:{x:r,y:o,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement("p",null,"Loading..."));var p=[],g=0,f=0;return i.forEach((function(e){var a=t/512,n=d.a[g++];g===d.a.length&&(g=0),m.forEach((function(t){var i=e.keypoints[t[0]],s=e.keypoints[t[1]],r=[parseInt(i[0]*a),parseInt(i[1]*a),parseInt(s[0]*a),parseInt(s[1]*a)];p.push(c.a.createElement(u.Line,{key:f++,points:r,stroke:n}))}))})),l?c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:n,width:a,height:t}),p)):c.a.createElement(h.a,{default:{x:r,y:o,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:n,width:a,height:t}),p)))}}]),a}(c.a.Component);t.a=p},56:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(12),r=a(10),o=a(9),l=a(0),c=a.n(l),h=a(14),u=a(118),d=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).initialState={height:400,width:600,isLoaded:!1,memory:null,xmin:-10,xmax:10,ymin:-10,ymax:10,bot_xyz:[0,0,0],tooltip:null},i.state=i.initialState,i.outer_div=c.a.createRef(),i.resizeHandler=i.resizeHandler.bind(Object(s.a)(i)),i}return Object(i.a)(a,[{key:"resizeHandler",value:function(){if(this.props.isMobile){var e=this.props.dimensions;(void 0!==e&&e!==this.state.height||void 0!==e&&e!==this.state.width)&&this.setState({height:e,width:e})}else if(null!=this.outer_div&&null!=this.outer_div.current){var t=this.outer_div.current,a=t.clientHeight,n=t.clientWidth;(void 0!==a&&a!==this.state.height||void 0!==n&&n!==this.state.width)&&this.setState({height:a,width:n})}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),void 0!==this.props.glContainer&&this.props.glContainer.on("resize",this.resizeHandler)}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.bot_xyz,n=this.state,i=n.xmin,s=n.xmax,r=n.ymin,o=n.ymax,l=a[0],c=a[1],h=!1;l<i&&(i=l,h=!0),l>s&&(s=l,h=!0),c<r&&(r=c,h=!0),c>o&&(o=c,h=!0),h&&this.setState({xmin:i,ymin:r,xmax:s,ymax:o}),this.resizeHandler()}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return c.a.createElement("p",null,"Loading");var t=this.state,a=t.height,n=t.width,i=t.memory,s=t.bot_xyz,r=t.obstacle_map,o=t.tooltip,l=i.objects,d=this.state,m=d.xmin,p=d.xmax,g=d.ymin,f=d.ymax,v=s[1],b=-s[0],y=s[2];if(0===a&&0===n)return c.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}});v=parseInt((v-m)/(p-m)*n),b=parseInt((b-g)/(f-g)*a),b=a-b;var E=[],k=[],w=0;r&&r.forEach((function(e){var t=parseInt((e[0]-m)/(p-m)*n),i=parseInt((e[1]-g)/(f-g)*a);k.push(c.a.createElement(h.Circle,{key:w++,radius:2,x:t,y:i,fill:"#827f7f"}))})),l.forEach((function(t,i,s){var r,o=u.a[Math.abs((r=t.label,r.split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0)))%10],l=t.xyz,d=parseInt((l[2]-m)/(p-m)*n),v=parseInt((-l[0]-g)/(f-g)*a);v=a-v,E.push(c.a.createElement(h.Circle,{key:w++,radius:3,x:d,y:v,fill:o,onMouseEnter:function(a){e.setState({tooltip:JSON.stringify(t,null,4)}),a.currentTarget.setRadius(6)},onMouseLeave:function(t){e.setState({tooltip:null}),t.currentTarget.setRadius(3)}}))})),E.push(c.a.createElement(h.Circle,{key:w++,radius:10,x:v,y:b,fill:"red"})),E.push(c.a.createElement(h.Line,{key:w++,x:v,y:b,points:[0,0,12,0],rotation:180*-y/Math.PI,stroke:"black"}));for(var M=[],O=0;O<n/10;O++)M.push(c.a.createElement(h.Line,{key:12344+O,points:[Math.round(10*O)+.5,0,Math.round(10*O)+.5,a],stroke:"#f5f5f5",strokeWidth:1}));for(M.push(c.a.createElement(h.Line,{key:12344+O++,points:[0,0,10,10]})),w=0;w<a/10;w++)M.push(c.a.createElement(h.Line,{key:12344+O+w,points:[0,Math.round(10*w),n,Math.round(10*w)],stroke:"#ddd",strokeWidth:.5}));return c.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}},c.a.createElement(h.Stage,{className:"memory2d",width:n,height:a},c.a.createElement(h.Layer,{className:"gridLayer"},M),c.a.createElement(h.Layer,{className:"mapBoundary"},k),c.a.createElement(h.Layer,{className:"renderedObjects"},E),c.a.createElement(h.Layer,null,c.a.createElement(h.Text,{text:o,offsetX:-12,offsetY:-12,visible:null!=o,shadowEnabled:!0}))))}}]),a}(c.a.Component);t.a=d},65:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(12),r=a(10),o=a(9),l=a(0),c=a.n(l),h=(a(208),a(116)),u=(a(209),{width:600,margin:50}),d={minWidth:"60px",display:"inline-block"},m=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).initialState={url:i.props.stateManager.url,fps:0,connected:!1,image_quality:-1,image_resolution:-1},i.props.isMobile&&(u={margin:50}),i.state=i.initialState,i.handleChange=i.handleChange.bind(Object(s.a)(i)),i.handleSubmit=i.handleSubmit.bind(Object(s.a)(i)),i.setImageSettings=i.setImageSettings.bind(Object(s.a)(i)),i.onImageQualityChange=i.onImageQualityChange.bind(Object(s.a)(i)),i.onImageResolutionChange=i.onImageResolutionChange.bind(Object(s.a)(i)),i}return Object(i.a)(a,[{key:"setImageSettings",value:function(e){this.setState(e)}},{key:"handleChange",value:function(e){this.setState({url:e.target.value})}},{key:"handleSubmit",value:function(e){this.props.stateManager.setUrl(this.state.url),e.preventDefault()}},{key:"handleClearSettings",value:function(e){this.props.stateManager.setDefaultUrl()}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.setState({connected:this.props.stateManager.connected}),this.props.stateManager.socket.on("image_settings",this.setImageSettings))}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&(this.props.stateManager.disconnect(this),this.setState({connected:!1}),this.props.stateManager.socket.off("image_settings",this.setImageSettings))}},{key:"onImageQualityChange",value:function(e){!0===this.state.connected&&this.props.stateManager.socket.emit("update_image_settings",{image_quality:e,image_resolution:this.state.image_resolution})}},{key:"onImageResolutionChange",value:function(e){!0===this.state.connected&&this.props.stateManager.socket.emit("update_image_settings",{image_quality:this.state.image_quality,image_resolution:e})}},{key:"render",value:function(){var e;e=!0===this.state.connected?c.a.createElement("status-indicator",{positive:!0,pulse:!0}):c.a.createElement("status-indicator",{negative:!0,pulse:!0});var t=!1;return-1===this.state.image_quality&&(t=!0),c.a.createElement("div",null,c.a.createElement("form",{onSubmit:this.handleSubmit},c.a.createElement("label",null,"Server / Robot URL:",c.a.createElement("input",{type:"text",value:this.state.url,onChange:this.handleChange})),c.a.createElement("input",{type:"submit",value:"Reconnect"})),c.a.createElement("form",{onSubmit:this.handleClearSettings},c.a.createElement("input",{type:"submit",value:"Clear Saved Settings"})),c.a.createElement("p",null,"FPS: ",this.state.fps),c.a.createElement("p",null," Connection Status: ",e," "),c.a.createElement("div",{style:u},c.a.createElement("label",{style:d},"Image Quality: \xa0"),c.a.createElement("span",null,this.state.image_quality),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(h.a,{value:this.state.image_quality,min:1,max:100,step:1,onChange:this.onImageQualityChange,disabled:t})),c.a.createElement("div",{style:u},c.a.createElement("label",{style:d},"Image Resolution: \xa0"),c.a.createElement("span",null,this.state.image_resolution),c.a.createElement("br",null),c.a.createElement("br",null),c.a.createElement(h.a,{value:this.state.image_resolution,min:16,max:512,step:16,onChange:this.onImageResolutionChange,disabled:t})))}}]),a}(c.a.Component);t.a=m},76:function(e,t,a){"use strict";var n=a(114),i=a(7),s=a(8),r=a(12),o=a(10),l=a(9),c=a(0),h=a.n(c),u=(a(168),a(421)),d=a(244),m=a(240),p=a(419),g=a(243),f=a(142),v=a.n(f),b=a(420),y=a(143),E=a.n(y),k=(a(169),new window.webkitSpeechRecognition);k.lang="en-US";var w=function(e){Object(o.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={recognizing:!1},n.toggleListen=n.toggleListen.bind(Object(r.a)(n)),n.listen=n.listen.bind(Object(r.a)(n)),n.elementRef=h.a.createRef(),n}return Object(s.a)(a,[{key:"renderChatHistory",value:function(e){var t=this;return this.props.chats.map((function(a,n){return h.a.cloneElement(h.a.createElement(m.a,null,h.a.createElement(g.a,null,a.msg+(a.msg?"Sent successfully"===e?" \u2705":" \u274c":"")),h.a.createElement(p.a,null,""!==a.msg?h.a.createElement(b.a,{edge:"end","aria-label":"Fail",onClick:function(){return t.props.goToQuestion(n)}},h.a.createElement(v.a,{className:"cross"})):null)),{key:n.toString()})}))}},{key:"isMounted",value:function(){return null!=this.elementRef.current}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&(e.preventDefault(),this.handleSubmit())}},{key:"componentDidMount",value:function(){document.addEventListener("keypress",this.handleKeyPress.bind(this))}},{key:"toggleListen",value:function(){console.log("togglelisten"),this.setState({recognizing:!this.state.recognizing},this.listen)}},{key:"listen",value:function(){this.state.recognizing?k.start():k.stop(),k.onresult=function(e){for(var t="",a=0;a<e.results.length;++a)e.results[a].isFinal&&(t+=e.results[a][0].transcript);document.getElementById("msg").innerHTML=t},k.onerror=function(e){console.log("Error in recognition: "+e.error)}}},{key:"handleSubmit",value:function(){var e=document.getElementById("msg").innerHTML;""!==e.replace(/\s/g,"")&&(this.props.setInteractState({msg:e,failed:!1}),this.props.stateManager.socket.emit("sendCommandToAgent",e),document.getElementById("msg").innerHTML="")}},{key:"render",value:function(){return h.a.createElement("div",{className:"Chat"},h.a.createElement("p",null,"Enter the command to the bot in the input box below, or click the mic button to start/stop voice input."),h.a.createElement("p",null,"Click the x next to the message if the outcome wasn't as expected."),h.a.createElement(E.a,{className:"ASRButton",variant:"contained",color:this.state.recognizing?"default":"secondary",fontSize:"large",onClick:this.toggleListen.bind(this)}),h.a.createElement(d.a,null,this.renderChatHistory(this.props.status)),!0===this.props.isMobile?h.a.createElement("div",{style:{outline:" solid 1px black"},contentEditable:"true",className:"Msg single-line",id:"msg",suppressContentEditableWarning:!0}," "):h.a.createElement("div",{contentEditable:"true",className:"Msg single-line",id:"msg",suppressContentEditableWarning:!0}," "),h.a.createElement(u.a,{className:"MsgButton",variant:"contained",color:"primary",onClick:this.handleSubmit.bind(this)}," ","Submit"," "),h.a.createElement("p",{id:"assistantReply"},this.props.agent_reply," "))}}]),a}(c.Component),M=a(434),O=(a(172),function(e){Object(o.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).state={view:0,parsing_error:!1,action_dict:{},feedback:""},n}return Object(s.a)(a,[{key:"finishQuestions",value:function(){var e={action_dict:this.state.action_dict,parsing_error:this.state.parsing_error,msg:this.props.chats[this.props.failidx].msg,feedback:this.state.feedback};this.props.stateManager.socket.emit("saveErrorDetailsToDb",e),this.props.goToMessage()}},{key:"saveFeedback",value:function(e){this.setState({feedback:e.target.value})}},{key:"renderParsingFail",value:function(){return h.a.createElement("div",null,h.a.createElement("h3",null," ","Thanks for letting me know that I didn't understand the command right."," "),h.a.createElement(u.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderParsingSuccess",value:function(){var e=this;return h.a.createElement("div",null,h.a.createElement("h3",null," ","Okay, looks like I understood your command but couldn't follow it all the way through. Tell me more about what I did wrong :"," "),h.a.createElement(M.a,{style:{backgroundColor:"white"},id:"outlined-uncontrolled",label:"",margin:"normal",variant:"outlined",onChange:function(t){return e.saveFeedback(t)}}),h.a.createElement("div",null),h.a.createElement(u.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderEnd",value:function(){var e=this;return h.a.createElement("div",null,h.a.createElement("h3",null," Thanks! Submit any other feedback here: "),h.a.createElement(M.a,{style:{backgroundColor:"white"},id:"outlined-uncontrolled",label:"",margin:"normal",variant:"outlined",onChange:function(t){return e.saveFeedback(t)}}),h.a.createElement("div",null),h.a.createElement(u.a,{variant:"contained",color:"primary",onClick:this.finishQuestions.bind(this)},"Done"))}},{key:"renderSemanticParserErrorQuestion",value:function(){var e=this,t=this.props.stateManager.memory.chatResponse,a=this.props.chats[this.props.failidx].msg;if(this.setState({action_dict:t[a]}),this.state.action_dict)if("dialogue_type"in this.state.action_dict){var n=this.state.action_dict.dialogue_type,i="";if("HUMAN_GIVE_COMMAND"===n){var s=this.state.action_dict.action_sequence[0],r=s.action_type.toLowerCase();i="to "+r+" ",["build","dig"].indexOf(r)>=0?("schematic"in s&&(i=i+"'"+s.schematic.text_span+"'"),"location"in s&&(i=i+" at location '"+s.location.text_span+"'"),i+=" ?"):["destroy","fill","spawn","copy","get","scout"].indexOf(r)>=0?("reference_object"in s&&(i=i+"'"+s.reference_object.text_span+"'"),"location"in s&&(i=i+" at location '"+s.location.text_span+"'"),i+=" ?"):["move"].indexOf(r)>=0?("location"in s&&(i=i+" at location '"+s.location.text_span+"'"),i+=" ?"):["stop","resume","undo"].indexOf(r)>=0&&("target_action_type"in s&&(i=i+" at location '"+s.target_action_type+"'"),i+=" ?")}else"GET_MEMORY"===n?i="to answer a question about something in the Minecraft world ?":"PUT_MEMORY"===n?i="to remember or learn something you taught it ?":"NOOP"===n&&(i="to do nothing ?")}else i="did you want me to do nothing ?";return h.a.createElement("div",{className:"question"},h.a.createElement("h5",null,"Did you want the assistant ",i),h.a.createElement(d.a,{className:"answers",component:"nav"},h.a.createElement(m.a,{button:!0,onClick:function(){return e.answerParsing(1)}},h.a.createElement(g.a,{primary:"Yes"})),h.a.createElement(m.a,{button:!0,onClick:function(){return e.answerParsing(2)}},h.a.createElement(g.a,{primary:"No"}))))}},{key:"answerParsing",value:function(e){1===e?this.setState({view:2}):2===e&&this.setState({parsing_error:!0,view:1})}},{key:"goToEnd",value:function(e){this.setState({view:3,new_action_dict:e})}},{key:"render",value:function(){return h.a.createElement("div",null,h.a.createElement("div",{className:"msg-header"},"Message you sent to the bot: ",h.a.createElement("br",null),this.props.chats[this.props.failidx].msg),0===this.state.view?this.renderSemanticParserErrorQuestion():null,1===this.state.view?this.renderParsingFail():null,2===this.state.view?this.renderParsingSuccess():null,3===this.state.view?this.renderEnd():null)}}]),a}(c.Component)),x=function(e){Object(o.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).initialState={currentView:1,chatResponse:"",status:"",chats:[{msg:"",failed:!1}],failidx:-1,agent_reply:""},n.state=n.initialState,n.setAssistantReply=n.setAssistantReply.bind(Object(r.a)(n)),n.MessageRef=h.a.createRef(),n}return Object(s.a)(a,[{key:"setInteractState",value:function(e){var t=Object(n.a)(this.state.chats);t.shift(),t.push(e),this.setState({chats:t})}},{key:"setAssistantReply",value:function(e){this.setState({agent_reply:e.agent_reply})}},{key:"componentDidMount",value:function(){this.props.stateManager&&(this.props.stateManager.connect(this),this.props.stateManager.socket.on("showAssistantReply",this.setAssistantReply))}},{key:"componentWillUnmount",value:function(){this.props.stateManager&&this.props.stateManager.disconnect(this)}},{key:"getUrlParameterByName",value:function(e){var t=RegExp("[?&]"+e+"=([^&]*)").exec(window.location.search);return t&&decodeURIComponent(t[1].replace(/\+/g," "))}},{key:"goToMessage",value:function(){var e=this.state.chats;-1!==this.state.failidx&&(e[this.state.failidx].failed=!0),this.setState({currentView:1,chats:e})}},{key:"goToQuestion",value:function(e){this.setState({currentView:2,chats:this.state.chats,failidx:e})}},{key:"render",value:function(){return h.a.createElement("div",{className:"App"},h.a.createElement("div",{className:"content"},1===this.state.currentView?h.a.createElement(w,{status:this.state.status,stateManager:this.props.stateManager,isMobile:this.props.isMobile,ref:this.MessageRef,chats:this.state.chats,agent_reply:this.state.agent_reply,goToQuestion:this.goToQuestion.bind(this),setInteractState:this.setInteractState.bind(this)}):null,2===this.state.currentView?h.a.createElement(O,{stateManager:this.props.stateManager,chats:this.state.chats,failidx:this.state.failidx,goToMessage:this.goToMessage.bind(this),failmsg:this.state.chats[this.state.failidx].msg}):null))}}]),a}(c.Component);t.a=x},77:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(12),r=a(10),o=a(9),l=a(0),c=a.n(l),h=a(50),u=a(14),d=a(118),m=a(96),p=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).onResize=i.onResize.bind(Object(s.a)(i)),i.onFixup=i.onFixup.bind(Object(s.a)(i)),i.initialState={height:e.height,width:e.width,rgb:null,objects:null},i.state=i.initialState,i}return Object(i.a)(a,[{key:"onResize",value:function(e,t,a,n,i){this.setState({width:parseInt(a.style.width,10),height:parseInt(a.style.height,10)})}},{key:"onFixup",value:function(){if(this.props.stateManager){var e=this.props.stateManager,t=void 0;if(e.refs.forEach((function(e){e instanceof m.a&&(t=e)})),void 0!==t){t.setState({image:this.state.rgb});for(var a=e.dashboardLayout,n=0;n<a._getAllContentItems().length;n++)if("ObjectFixup"===a._getAllContentItems()[n].config.component){var i=a._getAllContentItems()[n];i.parent.setActiveContentItem(i)}}}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){var e=this.state,t=e.height,a=e.width,n=e.rgb,i=e.objects,s=this.props,r=s.offsetW,o=s.offsetH;if(null===n)return c.a.createElement(h.a,{default:{x:r,y:o,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement("p",null,"Loading..."));var l=[],m=i;null===i&&(m=[]);var p=0;return m.forEach((function(e){var a=e.id,n=String(a).concat(e.label),i=e.properties,s=n.concat(i).split("").reduce((function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e}),0),r=d.a[Math.abs(s%d.a.length)],o=t/512,h=parseInt(e.bbox[0]*o),m=parseInt(e.bbox[1]*o),g=parseInt(e.bbox[2]*o),f=parseInt(e.bbox[3]*o)-m,v=g-h;l.push(c.a.createElement(u.Rect,{key:p,x:h,y:m,width:v,height:f,fillEnabled:!1,stroke:r})),l.push(c.a.createElement(u.Text,{key:[p++,n],text:n.concat("\n",i),x:h,y:m,fill:r,fontSize:10}));for(var b=function(t){var a=e.mask[t];l.push(c.a.createElement(u.Shape,{sceneFunc:function(e,t){e.beginPath(),e.moveTo(a[0][0]*o,a[0][1]*o);for(var n=1;n<a.length;n++)e.lineTo(a[n][0]*o,a[n][1]*o);e.closePath(),e.fillStrokeShape(t)},fill:r,opacity:.5,stroke:"black",strokeWidth:1}))},y=0;y<e.mask.length;y++)b(y)})),c.a.createElement(h.a,{default:{x:r,y:o,width:a,height:t},lockAspectRatio:!0,onResize:this.onResize},c.a.createElement(u.Stage,{width:a,height:t},c.a.createElement(u.Layer,null,c.a.createElement(u.Image,{image:n,width:a,height:t}),l)),c.a.createElement("button",{onClick:this.onFixup},"Fix"))}}]),a}(c.a.Component);t.a=p},93:function(e,t,a){"use strict";var n=a(37),i=a(7),s=a(8),r=a(10),o=a(9),l=a(0),c=a.n(l),h=a(41),u=a(35);function d(e){return null===e.value||void 0===e.value?null:c.a.createElement(c.a.Fragment,null,c.a.createElement(h.a,{item:!0,xs:4,s:4},c.a.createElement(u.a,{variant:"button",align:"right"},e.title)),c.a.createElement(h.a,{item:!0,xs:8,s:8},c.a.createElement(u.a,{variant:"body1",align:"left"},e.value)))}var m=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){return Object(i.a)(this,a),t.apply(this,arguments)}return Object(s.a)(a,[{key:"render",value:function(){var e=(0,Object(n.a)(this.props.memoryManager,3)[2])(this.props.uuid);return c.a.createElement(h.a,{container:!0,spacing:2,style:{padding:"16px"}},c.a.createElement(h.a,{item:!0,xs:11},c.a.createElement(u.a,{variant:"h4",align:"left"},"Attributes")),c.a.createElement(d,{title:"UUID",value:e.data[0]}),c.a.createElement(d,{title:"ID",value:e.data[1]}),c.a.createElement(d,{title:"X",value:e.data[2]}),c.a.createElement(d,{title:"Y",value:e.data[3]}),c.a.createElement(d,{title:"Z",value:e.data[4]}),c.a.createElement(d,{title:"Yaw",value:e.data[5]}),c.a.createElement(d,{title:"Pitch",value:e.data[6]}),c.a.createElement(d,{title:"Type",value:e.data[9]}),c.a.createElement(d,{title:"Name",value:e.data[7]}),c.a.createElement(h.a,{item:!0,xs:12},c.a.createElement(u.a,{variant:"h4",align:"left"},"Triples")),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"button",align:"left"},"Predicate")),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"button",align:"left"},"Value")),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"button",align:"left"},"Confidence")),e.triples.map((function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"body2",align:"left"},e[4])),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"body2",align:"left"},e[6])),c.a.createElement(h.a,{item:!0,xs:4},c.a.createElement(u.a,{variant:"body2",align:"left"},e[7])))})))}}]),a}(c.a.Component);t.a=m},94:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(10),r=a(9),o=a(0),l=a.n(o),c=a(244),h=a(240),u=a(243),d=(a(177),function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"renderChatHistory",value:function(){return this.props.stateManager.memory.chats.map((function(e,t){return l.a.cloneElement(l.a.createElement(h.a,{alignItems:"flex-start"},l.a.createElement("div",{className:"chatItem"},""!==e.msg?l.a.createElement(u.a,{primary:e.msg}):null)),{key:t.toString()})}))}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return l.a.createElement("div",{className:"history"},l.a.createElement("p",null,"The history of the last 5 commands sent to the bot."),l.a.createElement(c.a,null,this.renderChatHistory()))}}]),a}(l.a.Component));t.a=d},95:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(10),r=a(9),o=a(0),l=a.n(o),c=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(){return Object(n.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"renderHandshake",value:function(){return this.props.stateManager.socket.emit("receiveTimelineHandshake","Sent message!"),this.props.stateManager.memory.timelineHandshake}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return l.a.createElement("div",{className:"timeline"},l.a.createElement("p",null,"A visualizer where users can easily view, inspect, and search through agent activities interactively."),l.a.createElement("p",null,"Handshake status: ",this.renderHandshake()))}}]),a}(l.a.Component);t.a=c},96:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(10),r=a(9),o=a(0),l=a.n(o),c=a(12),h=(a(166),a(167),function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={selectedTags:[],suggestions:[],currentValue:""},i.inputRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"tag-selector"},l.a.createElement("div",{className:"tag-holder"},this.state.selectedTags.map((function(t){return l.a.createElement("span",{class:"tag-selected"},t,l.a.createElement("button",{onClick:function(){e.removeTag(t)}},"X"))}))),l.a.createElement("input",{type:"text",placeholder:"Tags (press Enter to add)",ref:this.inputRef,onChange:this.update.bind(this),onKeyDown:this.keyDown.bind(this)}),l.a.createElement("div",{className:"tag-suggestions"},this.state.suggestions.map((function(t){return l.a.createElement("span",null,l.a.createElement("button",{onClick:function(){e.addTag(t)}},t))}))))}},{key:"update",value:function(e){var t=this,a=this.inputRef.current.value;0!==a.length?this.setState({suggestions:this.props.tags.filter((function(e){return e.toLowerCase().slice(0,a.length)===a&&-1===t.state.selectedTags.indexOf(e)}))}):this.setState({suggestions:[]})}},{key:"removeTag",value:function(e){var t=this;this.setState({selectedTags:this.state.selectedTags.filter((function(t){return t!==e}))},(function(){t.props.update(t.state.selectedTags)}))}},{key:"addTag",value:function(e){var t=this;e=e.toLowerCase(),this.setState({selectedTags:this.state.selectedTags.concat(e),suggestions:[]},(function(){t.props.update(t.state.selectedTags)})),this.inputRef.current.value=""}},{key:"keyDown",value:function(e){"Enter"===e.key&&""!==this.inputRef.current.value.trim()&&this.addTag(this.inputRef.current.value),this.setState({currentValue:this.inputRef.current.value})}}]),a}(l.a.Component)),u=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).labels=[],i.tags=[],i.nameRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return l.a.createElement("div",{className:"data-entry-root",style:{top:this.props.y+"px",left:this.props.x+"px",position:"fixed"}},l.a.createElement("input",{placeholder:"Object Name",ref:this.nameRef}),l.a.createElement(h,{tags:this.labels,update:function(t){return e.tags=t}}),l.a.createElement("button",{className:"data-entry-submit",onClick:this.submit.bind(this)},"Submit"))}},{key:"submit",value:function(){var e=this.nameRef.current.value.trim();0!==e.length?this.tags.length<2?alert("Please enter at least 2 descriptive tags for the object. Examples include: color, shape, size, orientation, etc."):this.props.onSubmit({name:e.toLowerCase(),tags:this.tags}):alert("You must enter the object's name")}}]),a}(l.a.Component),d=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).update=i.update.bind(Object(c.a)(i)),i.onClick=i.onClick.bind(Object(c.a)(i)),i.onMouseMove=i.onMouseMove.bind(Object(c.a)(i)),i.keyDown=i.keyDown.bind(Object(c.a)(i)),i.drawPoint=i.drawPoint.bind(Object(c.a)(i)),i.drawLine=i.drawLine.bind(Object(c.a)(i)),i.localToImage=i.localToImage.bind(Object(c.a)(i)),i.imageToLocal=i.imageToLocal.bind(Object(c.a)(i)),i.shiftViewBy=i.shiftViewBy.bind(Object(c.a)(i)),i.isDrawingPolygon=!1,i.lastMouse={x:0,y:0},i.dragging=!1,i.canvasRef=l.a.createRef(),i.zoomPixels=300,i.pointSize=10,i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.points=[],this.img=this.props.img,this.Offset={x:0,y:0},this.baseScale=Math.min(this.canvas.width/this.img.width,this.canvas.height/this.img.height),this.scale=this.baseScale,this.update()}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("p",null,"Please trace the ",this.props.object),l.a.createElement("canvas",{ref:this.canvasRef,width:"500px",height:"500px",tabIndex:"0",onClick:this.onClick,onMouseMove:this.onMouseMove,onKeyDown:this.keyDown}))}},{key:"update",value:function(){var e=this;if(this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y),this.ctx.drawImage(this.img,0,0),"Enter"!==this.lastKey){for(var t=0;t<this.points.length-1;t++)this.drawLine(this.points[t],this.points[t+1]);this.points.length>0&&!this.dragging&&this.drawLine(this.points[this.points.length-1],this.localToImage(this.lastMouse)),this.points.forEach((function(t){e.drawPoint(t)}))}else{if(this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.baseScale,0,0,this.baseScale,0,0),this.ctx.drawImage(this.img,0,0),this.points.length<3)return;var a=new Path2D;a.moveTo(this.points[0].x,this.points[0].y);for(var n=1;n<this.points.length;n++)a.lineTo(this.points[n].x,this.points[n].y);a.closePath(),this.ctx.fillStyle="rgba(0,200,0,.5)",this.ctx.fill(a,"evenodd")}}},{key:"updateZoom",value:function(){this.scale=Math.min(this.canvas.width/this.zoomPixels,this.canvas.height/this.zoomPixels),0!==this.points.length&&(this.Offset={x:-(this.points[this.points.length-1].x-this.zoomPixels/2)*this.scale,y:-(this.points[this.points.length-1].y-this.zoomPixels/2)*this.scale})}},{key:"onMouseMove",value:function(e){var t=this.canvas.getBoundingClientRect();this.lastMouse={x:e.clientX-t.left,y:e.clientY-t.top+1},this.dragging&&(this.points[this.draggingIndex]=this.localToImage(this.lastMouse)),this.update()}},{key:"onClick",value:function(e){if(this.dragging)return this.dragging=!1,void this.update();for(var t=null,a=0;a<this.points.length;a++)this.distance(this.points[a],this.localToImage(this.lastMouse))<this.pointSize/2&&(t=a);if(null!=t)return this.dragging=!0,this.draggingIndex=t,void this.update();"Enter"!==this.lastKey&&this.points.push(this.localToImage(this.lastMouse)),this.updateZoom(),this.isDrawingPolygon||(this.points.pop(),this.isDrawingPolygon=!0),this.update(),this.lastKey="Mouse"}},{key:"keyDown",value:function(e){switch(e.key){case" ":this.points.length>0&&this.points.pop();break;case"w":this.shiftViewBy(0,10);break;case"a":this.shiftViewBy(10,0);break;case"s":this.shiftViewBy(0,-10);break;case"d":this.shiftViewBy(-10,0);break;case"Enter":"Enter"===this.lastKey&&(this.lastKey=null,this.props.submitCallback(this.points));break;case"=":this.zoomPixels-=10,this.updateZoom()}this.lastKey=e.key,this.update()}},{key:"drawPoint",value:function(e){this.ctx.fillStyle="black",this.distance(e,this.localToImage(this.lastMouse))<this.pointSize/2&&(this.ctx.fillStyle="green"),this.ctx.fillRect(e.x-2.5,e.y-2.5,5,5)}},{key:"drawLine",value:function(e,t){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}},{key:"localToImage",value:function(e){return{x:(e.x-this.Offset.x)/this.scale,y:(e.y-this.Offset.y)/this.scale}}},{key:"imageToLocal",value:function(e){return{x:e.x*this.scale+this.Offset.x,y:e.y*this.scale+this.Offset.y}}},{key:"resetView",value:function(){this.Offset={x:0,y:0},this.scale=Math.min(this.canvas.width/this.img.width,this.canvas.height/this.img.height)}},{key:"shiftViewBy",value:function(e,t){this.Offset={x:this.Offset.x+e,y:this.Offset.y+t}}},{key:"distance",value:function(e,t){return 2*Math.max(Math.abs(e.x-t.x),Math.abs(e.y-t.y))}}]),a}(l.a.Component),m=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).update=i.update.bind(Object(c.a)(i)),i.drawLine=i.drawLine.bind(Object(c.a)(i)),i.canvasRef=l.a.createRef(),i.imgRef=l.a.createRef(),i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.canvas=this.canvasRef.current,this.ctx=this.canvas.getContext("2d"),this.Offset={x:0,y:0},this.baseScale=this.canvas.width/this.props.img.width,this.scale=this.baseScale,this.canvas.height=this.props.img.height*this.baseScale,this.update()}},{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement("canvas",{ref:this.canvasRef,width:"500px",height:"500px",tabIndex:"0",onClick:this.props.onClick,onMouseMove:this.onMouseMove,onKeyDown:this.keyDown}))}},{key:"update",value:function(){this.ctx.resetTransform(),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.setTransform(this.scale,0,0,this.scale,this.Offset.x,this.Offset.y),this.ctx.drawImage(this.props.img,0,0);for(var e=0;e<this.props.objects.length;e++){var t=this.props.pointMap[this.props.objects[e]];if(t){var a=this.props.colors[e%this.props.colors.length];a?this.drawRegion(t,a):this.drawRegion(t,"rgba(0,200,0,.5)")}}}},{key:"drawLine",value:function(e,t){this.ctx.beginPath(),this.ctx.moveTo(e.x,e.y),this.ctx.lineTo(t.x,t.y),this.ctx.stroke()}},{key:"drawRegion",value:function(e,t){if(!(e.length<3)){var a=new Path2D;a.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)a.lineTo(e[n].x,e[n].y);a.closePath(),this.ctx.fillStyle=t,this.ctx.fill(a,"evenodd")}}}]),a}(l.a.Component),p=["rgba(0,200,0,.5)","rgba(200,0,0,.5)","rgba(0,0,200,.5)","rgba(200,200,0,.5)","rgba(0,200,200,.5)","rgba(200,0,200,.5)","rgba(150,50,50,.5)","rgba(255, 153, 0, .5)","rgba(128,0,128,.5)","rgba(0,204,255,.5)","rgba(153,204,0,.5)"],g=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={objectIds:[],currentMode:"select",currentOverlay:null},i.currentId=0,i.nameMap={},i.pointMap={},i.propertyMap={},i.registerClick=i.registerClick.bind(Object(c.a)(i)),void 0!==i.props.image?i.image=i.props.image:(i.image=new Image,i.image.onload=function(){i.forceUpdate()},i.image.src=i.props.imgUrl),i.overtime=!1,setInterval((function(){i.overtime=!0}),6e4*window.MINUTES),i}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return"draw_polygon"!==this.state.currentMode?l.a.createElement("div",null,l.a.createElement("p",null,"Label and outline as ",l.a.createElement("b",null,"many objects as possible.")," Click an object in the image to start. ",this.state.objectIds.length," ","object(s) labeled."),this.state.currentOverlay,l.a.createElement(m,{img:this.image,objects:this.state.objectIds,pointMap:this.pointMap,colors:p,onClick:function(t){return e.registerClick(t.clientX,t.clientY)}}),l.a.createElement("button",{onClick:this.submit.bind(this)},"Finished annotating objects")):l.a.createElement(d,{img:this.image,object:this.drawing_data.name,submitCallback:this.drawingFinished.bind(this)})}},{key:"registerClick",value:function(e,t){if("select"===this.state.currentMode){var a=l.a.createElement(u,{x:e,y:t,onSubmit:this.dataEntered.bind(this)});this.setState({currentMode:"fill_data",currentOverlay:a})}}},{key:"dataEntered",value:function(e){this.drawing_data=e,this.setState({currentMode:"draw_polygon",currentOverlay:null})}},{key:"drawingFinished",value:function(e){var t=this;this.propertyMap[this.currentId]=this.drawing_data.tags,this.pointMap[this.currentId]=e,this.nameMap[this.currentId]=this.drawing_data.name,this.setState({currentMode:"select",objectIds:this.state.objectIds.splice(0).concat(this.currentId)},(function(){t.currentId+=1}))}},{key:"submit",value:function(){if(this.state.objectIds.length<window.MIN_OBJECTS)alert("Label more objects, or your HIT may be rejected");else{var e={nameMap:this.nameMap,propertyMap:this.propertyMap,pointMap:this.pointMap};this.props.stateManager.socket.emit("saveObjectAnnotation",e),this.props.not_turk}}}]),a}(l.a.Component),f=function(e){Object(s.a)(a,e);var t=Object(r.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).initialState={image:void 0},i.state=i.initialState,i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this)}},{key:"render",value:function(){return void 0===this.state.image?null:l.a.createElement(g,{image:this.state.image,not_turk:!0,stateManager:this.props.stateManager})}}]),a}(l.a.Component);t.a=f},97:function(e,t,a){"use strict";var n=a(7),i=a(8),s=a(12),r=a(10),o=a(9),l=a(0),c=a.n(l),h=a(37),u=a(68),d=a(69),m=a(52),p=a(6),g=a(13),f=a(436),v=a(89),b=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(){var e;Object(n.a)(this,a);for(var i=arguments.length,s=new Array(i),r=0;r<i;r++)s[r]=arguments[r];return(e=t.call.apply(t,[this].concat(s))).getRowClassName=function(t){var a=t.index,n=e.props,i=n.classes,s=n.onRowClick;return Object(p.a)(i.tableRow,i.flexContainer,Object(m.a)({},i.tableRowHover,-1!==a&&null!=s))},e.cellRenderer=function(t){var a=t.cellData,n=t.columnIndex,i=e.props,s=i.columns,r=i.classes,o=i.rowHeight,l=i.onRowClick;return c.a.createElement(f.a,{component:"div",className:Object(p.a)(r.tableCell,r.flexContainer,Object(m.a)({},r.noClick,null==l)),variant:"body",style:{height:o},align:null!=n&&s[n].numeric?"right":"left"},a)},e.headerRenderer=function(t){var a=t.label,n=t.columnIndex,i=e.props,s=i.headerHeight,r=i.columns,o=i.classes;return c.a.createElement(f.a,{component:"div",className:Object(p.a)(o.tableCell,o.flexContainer,o.noClick),variant:"head",style:{height:s},align:r[n].numeric?"right":"left"},c.a.createElement("span",null,a))},e}return Object(i.a)(a,[{key:"render",value:function(){var e=this,t=this.props,a=t.height,n=t.width,i=t.classes,s=t.columns,r=t.rowHeight,o=t.headerHeight,l=Object(d.a)(t,["height","width","classes","columns","rowHeight","headerHeight"]);return c.a.createElement(v.c,Object.assign({height:a,width:n,rowHeight:r,gridStyle:{direction:"inherit"},size:"small",headerHeight:o,className:i.table},l,{rowClassName:this.getRowClassName}),s.map((function(t,a){var n=t.dataKey,s=Object(d.a)(t,["dataKey"]);return c.a.createElement(v.b,Object.assign({key:n,headerRenderer:function(t){return e.headerRenderer(Object(u.a)(Object(u.a)({},t),{},{columnIndex:a}))},className:i.flexContainer,cellRenderer:e.cellRenderer,dataKey:n},s))})))}}]),a}(c.a.PureComponent);b.defaultProps={headerHeight:48,rowHeight:36};var y=Object(g.a)((function(e){return{flexContainer:{display:"flex",alignItems:"center",boxSizing:"border-box"},table:{"& .ReactVirtualized__Table__headerRow":{flip:!1,paddingRight:"rtl"===e.direction?"0 !important":void 0}},tableRow:{cursor:"pointer"},tableRowHover:{"&:hover":{backgroundColor:e.palette.action.hover}},tableCell:{flex:1},noClick:{cursor:"initial"}}}))(b);function E(e){var t=e.memoryManager,a=e.onShowMemoryDetail,n=Object(h.a)(t,2),i=n[0],s=n[1];return c.a.createElement(v.a,null,(function(e){var t=e.height,n=e.width;return c.a.createElement(y,{height:t,width:n,rowCount:i(),rowGetter:function(e){var t,a=e.index;return{uuid:(t=s(a)).data[0],id:t.data[1],type:t.data[9],name:t.data[7]}},onRowClick:function(e){e.event,e.index;var t=e.rowData;t&&t.uuid&&a(t.uuid)},columns:[{flexGrow:1,width:1,label:"ID",dataKey:"id",numeric:!0},{flexGrow:5,width:5,label:"Type",dataKey:"type",numeric:!1},{flexGrow:5,width:5,label:"Name",dataKey:"name",numeric:!1}]})}))}var k=a(148);function w(e,t){e.memories,e.named_abstractions;var a=e.reference_objects,n=e.triples,i=new Map(a.map((function(e){return[e[0],{data:e}]})));n&&n.forEach((function(e){var t=e[1],a=i.get(t);a&&(a.triples?a.triples.push(e):a.triples=[e])}));var s=[];if(null!=t&&t.length>0){var r,o=Object(k.a)(i.values());try{for(o.s();!(r=o.n()).done;){var l=r.value;JSON.stringify(l).includes(t)&&s.push(l)}}catch(c){o.e(c)}finally{o.f()}}else s=Array.from(i.values());return[function(){return s.length},function(e){return s[e]},function(e){return i.get(e)}]}var M=a(93),O=a(434),x=a(437),j=a(420),S=a(149),C=a.n(S),_=a(423),R=a(239),I=a(422),T=function(e){Object(r.a)(a,e);var t=Object(o.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).initialState={height:400,width:600,isLoaded:!1,memory:null,filter:"",showDetail:!1,detailUUID:null},i.state=i.initialState,i.outer_div=c.a.createRef(),i.resizeHandler=i.resizeHandler.bind(Object(s.a)(i)),i}return Object(i.a)(a,[{key:"resizeHandler",value:function(){if(null!=this.outer_div&&null!=this.outer_div.current){var e=this.outer_div.current,t=e.clientHeight,a=e.clientWidth;(void 0!==t&&t!==this.state.height||void 0!==a&&a!==this.state.width)&&this.setState({height:t,width:a})}}},{key:"componentDidMount",value:function(){this.props.stateManager&&this.props.stateManager.connect(this),void 0!==this.props.glContainer&&this.props.glContainer.on("resize",this.resizeHandler)}},{key:"componentDidUpdate",value:function(e,t){this.resizeHandler()}},{key:"render",value:function(){var e=this;if(!this.state.isLoaded)return c.a.createElement("p",null,"Loading");var t=this.state,a=t.height,n=t.width,i=t.memory,s=t.isLoaded;if(0===a&&0===n)return c.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}});if(!s)return c.a.createElement("div",{ref:this.outer_div,style:{height:"100%",width:"100%"}},"Loading...");var r=Object(R.a)({palette:{type:"dark"}}),o=new w(i,this.state.filter),l=this.state.height-24,h=this.state.width-24,u=function(){e.setState({showDetail:!1})};return c.a.createElement(I.a,{theme:r},c.a.createElement(O.a,{style:{borderBlockColor:"white"},color:"primary",id:"outlined-uncontrolled",label:"Search",margin:"dense",variant:"outlined",onChange:function(t){e.setState({filter:t.target.value})}}),c.a.createElement(E,{height:l,width:h,memoryManager:o,onShowMemoryDetail:function(t){e.setState({detailUUID:t,showDetail:!0})}}),c.a.createElement(x.a,{anchor:"right",open:this.state.showDetail,onClose:function(){u()}},c.a.createElement("div",{style:{width:450}},c.a.createElement(j.a,{onClick:function(){return u()}},c.a.createElement(C.a,null)),c.a.createElement(_.a,null),c.a.createElement(M.a,{memoryManager:o,uuid:this.state.detailUUID}))))}}]),a}(c.a.Component);t.a=T}},[[376,155,0,158]]]);